{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"OmniStack Backend Documentation","text":"<p>Welcome to the OmniStack Backend documentation! This is a production-ready FastAPI backend boilerplate for SaaS applications.</p>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li> <p> Getting Started</p> <p>Set up your development environment in 60 seconds</p> <p> Quick Start</p> </li> <li> <p> API Reference</p> <p>Complete endpoint documentation with request/response examples</p> <p> API Docs</p> </li> <li> <p> Architecture</p> <p>System design, patterns, and naming conventions</p> <p> Architecture</p> </li> <li> <p> Modular Guide</p> <p>Pick and choose only the components you need</p> <p> Customize</p> </li> <li> <p> Frontend Integration</p> <p>TypeScript types, React, Next.js, iOS, and Android examples</p> <p> Integration</p> </li> <li> <p> Contributing</p> <p>Code style, testing requirements, and PR process</p> <p> Contribute</p> </li> </ul>"},{"location":"#features","title":"Features","text":""},{"location":"#core","title":"Core","text":"<ul> <li>JWT Authentication - Supabase, Clerk, or custom OAuth</li> <li>Generic CRUD - Reusable patterns with pagination</li> <li>Soft Delete - Non-destructive data removal</li> <li>Rate Limiting - Redis-backed sliding window</li> <li>Security Headers - CORS, CSP, HSTS</li> </ul>"},{"location":"#external-services-pluggable","title":"External Services (Pluggable)","text":"Service Providers AI Gateway OpenAI, Anthropic, Google Gemini Email Resend, SendGrid Storage AWS S3, Cloudflare R2, Cloudinary Payments Stripe, Apple IAP, Google Play"},{"location":"#observability","title":"Observability","text":"<ul> <li>Prometheus metrics</li> <li>Sentry error tracking</li> <li>Structured JSON logging</li> </ul>"},{"location":"#tech-stack","title":"Tech Stack","text":"Component Technology Runtime Python 3.12+ Framework FastAPI ORM SQLModel (Pydantic + SQLAlchemy) Database PostgreSQL 16+ Cache Redis 7+ Background Jobs ARQ Testing Pytest Linting Ruff"},{"location":"#philosophy","title":"Philosophy","text":"<p>\"Zero to API in 60 seconds, Zero to Production in 60 minutes\"</p> <p>This boilerplate follows:</p> <ul> <li>12-Factor App - All config via environment variables</li> <li>Adapter Pattern - Swap providers without changing business logic</li> <li>Clean Architecture - Business logic separated from HTTP layer</li> <li>Async-First - Non-blocking I/O everywhere</li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>GitHub Issues</li> <li>GitHub Discussions</li> </ul> <p>v1.0 - Production Ready</p>"},{"location":"API-REFERENCE/","title":"API Reference","text":"<p>Complete API documentation for OmniStack Backend.</p>"},{"location":"API-REFERENCE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Overview</li> <li>Authentication</li> <li>Response Formats</li> <li>Error Responses</li> <li>Pagination</li> <li>Rate Limiting</li> <li>Endpoints</li> <li>Health</li> <li>Users</li> <li>Projects</li> <li>Files</li> <li>AI</li> <li>Billing</li> <li>Admin</li> <li>Webhooks</li> </ol>"},{"location":"API-REFERENCE/#overview","title":"Overview","text":""},{"location":"API-REFERENCE/#base-url","title":"Base URL","text":"<pre><code>Development: http://localhost:8000/api/v1\nProduction:  https://your-domain.com/api/v1\n</code></pre>"},{"location":"API-REFERENCE/#route-structure","title":"Route Structure","text":"<pre><code>/api/v1/\n\u251c\u2500\u2500 public/          # No authentication required\n\u2502   \u251c\u2500\u2500 health       # Health checks\n\u2502   \u251c\u2500\u2500 webhooks/    # External service webhooks\n\u2502   \u2514\u2500\u2500 metrics      # Prometheus metrics\n\u2502\n\u251c\u2500\u2500 app/             # Authentication required\n\u2502   \u251c\u2500\u2500 users/       # User profile management\n\u2502   \u251c\u2500\u2500 projects/    # Project CRUD\n\u2502   \u251c\u2500\u2500 files/       # File upload/download\n\u2502   \u251c\u2500\u2500 ai/          # AI completions\n\u2502   \u2514\u2500\u2500 billing/     # Subscription management\n\u2502\n\u2514\u2500\u2500 admin/           # Authentication + Admin role required\n    \u251c\u2500\u2500 users/       # User management\n    \u2514\u2500\u2500 jobs/        # Background job monitoring\n</code></pre>"},{"location":"API-REFERENCE/#http-methods-convention","title":"HTTP Methods Convention","text":"Method Usage Example <code>GET</code> Retrieve resource(s) <code>GET /projects</code> <code>POST</code> Create new resource <code>POST /projects</code> <code>PATCH</code> Partial update <code>PATCH /projects/{id}</code> <code>DELETE</code> Remove resource <code>DELETE /projects/{id}</code> <p>Note: We use <code>PATCH</code> (not <code>PUT</code>) for updates because all update fields are optional.</p>"},{"location":"API-REFERENCE/#authentication","title":"Authentication","text":""},{"location":"API-REFERENCE/#bearer-token","title":"Bearer Token","text":"<p>All <code>/app/*</code> and <code>/admin/*</code> endpoints require a JWT token in the <code>Authorization</code> header:</p> <pre><code>Authorization: Bearer &lt;jwt_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#supported-auth-providers","title":"Supported Auth Providers","text":"Provider JWT Algorithm Token Source Supabase RS256 (or HS256 legacy) <code>supabase.auth.getSession()</code> Clerk RS256 <code>useAuth().getToken()</code> Custom OAuth RS256 Your OAuth provider"},{"location":"API-REFERENCE/#token-structure-jwt-claims","title":"Token Structure (JWT Claims)","text":"<pre><code>{\n  \"sub\": \"user_123abc\",           // User ID (required)\n  \"email\": \"user@example.com\",    // User email\n  \"role\": \"user\",                 // user | admin | superadmin\n  \"exp\": 1704067200,              // Expiration timestamp\n  \"iat\": 1704063600               // Issued at timestamp\n}\n</code></pre>"},{"location":"API-REFERENCE/#authentication-errors","title":"Authentication Errors","text":"Status Code Description 401 <code>AUTHENTICATION_ERROR</code> Missing or invalid token 403 <code>AUTHORIZATION_ERROR</code> Insufficient permissions"},{"location":"API-REFERENCE/#response-formats","title":"Response Formats","text":""},{"location":"API-REFERENCE/#success-response-single-resource","title":"Success Response (Single Resource)","text":"<pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"name\": \"My Project\",\n  \"description\": \"Project description\",\n  \"owner_id\": \"user_123abc\",\n  \"created_at\": \"2026-01-10T12:00:00Z\",\n  \"updated_at\": \"2026-01-10T12:00:00Z\"\n}\n</code></pre>"},{"location":"API-REFERENCE/#success-response-list-with-pagination","title":"Success Response (List with Pagination)","text":"<pre><code>{\n  \"items\": [\n    {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"name\": \"Project 1\",\n      \"created_at\": \"2026-01-10T12:00:00Z\"\n    },\n    {\n      \"id\": \"660e8400-e29b-41d4-a716-446655440001\",\n      \"name\": \"Project 2\",\n      \"created_at\": \"2026-01-09T12:00:00Z\"\n    }\n  ],\n  \"total\": 42,\n  \"skip\": 0,\n  \"limit\": 20\n}\n</code></pre>"},{"location":"API-REFERENCE/#success-response-simple-message","title":"Success Response (Simple Message)","text":"<pre><code>{\n  \"message\": \"Operation completed successfully\"\n}\n</code></pre>"},{"location":"API-REFERENCE/#no-content-response","title":"No Content Response","text":"<p>For <code>DELETE</code> operations, returns <code>204 No Content</code> with empty body.</p>"},{"location":"API-REFERENCE/#error-responses","title":"Error Responses","text":""},{"location":"API-REFERENCE/#error-response-format","title":"Error Response Format","text":"<p>All errors follow this consistent structure:</p> <pre><code>{\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"Human-readable error message\",\n    \"details\": {\n      \"field\": \"additional_info\"\n    }\n  }\n}\n</code></pre>"},{"location":"API-REFERENCE/#error-codes-reference","title":"Error Codes Reference","text":"HTTP Status Code Description Common Causes 400 <code>BAD_REQUEST</code> Invalid request Malformed JSON, invalid parameters 401 <code>AUTHENTICATION_ERROR</code> Auth failed Missing/expired token 403 <code>AUTHORIZATION_ERROR</code> Access denied Wrong role, not owner 404 <code>NOT_FOUND</code> Resource not found Invalid ID, deleted resource 409 <code>CONFLICT</code> Resource conflict Duplicate entry 422 <code>VALIDATION_ERROR</code> Validation failed Invalid field values 429 <code>RATE_LIMIT_EXCEEDED</code> Too many requests Rate limit hit 502 <code>EXTERNAL_SERVICE_ERROR</code> External service failed AI/Email/Payment error 503 <code>SERVICE_UNAVAILABLE</code> Service not configured Missing API keys"},{"location":"API-REFERENCE/#example-error-responses","title":"Example Error Responses","text":"<p>Not Found (404) <pre><code>{\n  \"error\": {\n    \"code\": \"NOT_FOUND\",\n    \"message\": \"Project not found\",\n    \"details\": {\n      \"resource\": \"Project\",\n      \"id\": \"invalid-uuid\"\n    }\n  }\n}\n</code></pre></p> <p>Validation Error (422) <pre><code>{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Name must be at least 1 character\",\n    \"details\": {\n      \"field\": \"name\"\n    }\n  }\n}\n</code></pre></p> <p>Rate Limit (429) <pre><code>{\n  \"error\": {\n    \"code\": \"RATE_LIMIT_EXCEEDED\",\n    \"message\": \"Rate limit exceeded\",\n    \"details\": {\n      \"retry_after\": 60\n    }\n  }\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#pagination","title":"Pagination","text":""},{"location":"API-REFERENCE/#query-parameters","title":"Query Parameters","text":"Parameter Type Default Range Description <code>skip</code> integer 0 0+ Number of items to skip <code>limit</code> integer 20 1-100 Maximum items to return"},{"location":"API-REFERENCE/#request-example","title":"Request Example","text":"<pre><code>GET /api/v1/app/projects?skip=20&amp;limit=10\n</code></pre>"},{"location":"API-REFERENCE/#response-structure","title":"Response Structure","text":"<pre><code>{\n  \"items\": [...],\n  \"total\": 100,    // Total items in database\n  \"skip\": 20,      // Items skipped\n  \"limit\": 10      // Max items returned\n}\n</code></pre>"},{"location":"API-REFERENCE/#calculating-pagination","title":"Calculating Pagination","text":"<pre><code>// Frontend pagination helper\nconst totalPages = Math.ceil(response.total / response.limit);\nconst currentPage = Math.floor(response.skip / response.limit) + 1;\nconst hasNextPage = response.skip + response.items.length &lt; response.total;\nconst hasPrevPage = response.skip &gt; 0;\n</code></pre>"},{"location":"API-REFERENCE/#rate-limiting","title":"Rate Limiting","text":""},{"location":"API-REFERENCE/#rate-limit-headers","title":"Rate Limit Headers","text":"<p>Every response includes these headers:</p> Header Description Example <code>X-RateLimit-Limit</code> Max requests per window <code>60</code> <code>X-RateLimit-Remaining</code> Remaining requests <code>45</code> <code>X-RateLimit-Reset</code> Unix timestamp when limit resets <code>1704067200</code>"},{"location":"API-REFERENCE/#default-limits","title":"Default Limits","text":"Route Pattern Limit Window Default 60 requests per minute <code>/app/ai/*</code> 10 requests per minute <code>/public/auth/*</code> 5 requests per minute"},{"location":"API-REFERENCE/#rate-limit-response-429","title":"Rate Limit Response (429)","text":"<pre><code>HTTP/1.1 429 Too Many Requests\nX-RateLimit-Limit: 60\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1704067200\nRetry-After: 45\n\n{\n  \"error\": {\n    \"code\": \"RATE_LIMIT_EXCEEDED\",\n    \"message\": \"Rate limit exceeded\",\n    \"details\": {\n      \"retry_after\": 45\n    }\n  }\n}\n</code></pre>"},{"location":"API-REFERENCE/#endpoints","title":"Endpoints","text":""},{"location":"API-REFERENCE/#health-endpoints","title":"Health Endpoints","text":""},{"location":"API-REFERENCE/#check-health","title":"Check Health","text":"<pre><code>GET /api/v1/public/health\n</code></pre> <p>Response (200) <pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2026-01-10T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#check-readiness","title":"Check Readiness","text":"<pre><code>GET /api/v1/public/health/ready\n</code></pre> <p>Response (200) <pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2026-01-10T12:00:00Z\",\n  \"components\": {\n    \"database\": { \"status\": \"healthy\" },\n    \"cache\": { \"status\": \"healthy\" }\n  }\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#user-endpoints","title":"User Endpoints","text":""},{"location":"API-REFERENCE/#get-current-user","title":"Get Current User","text":"<pre><code>GET /api/v1/app/users/me\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"id\": \"user_123abc\",\n  \"email\": \"user@example.com\",\n  \"full_name\": \"John Doe\",\n  \"avatar_url\": \"https://example.com/avatar.jpg\",\n  \"role\": \"user\",\n  \"is_active\": true,\n  \"subscription_plan\": \"pro\",\n  \"subscription_status\": \"active\",\n  \"created_at\": \"2026-01-01T00:00:00Z\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#update-current-user","title":"Update Current User","text":"<pre><code>PATCH /api/v1/app/users/me\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"full_name\": \"John Smith\",\n  \"avatar_url\": \"https://example.com/new-avatar.jpg\"\n}\n</code></pre> <p>Request Body</p> Field Type Required Description <code>full_name</code> string No Display name (max 255 chars) <code>avatar_url</code> string No Avatar URL (max 2048 chars) <p>Response (200): Updated user object</p>"},{"location":"API-REFERENCE/#project-endpoints","title":"Project Endpoints","text":""},{"location":"API-REFERENCE/#list-projects","title":"List Projects","text":"<pre><code>GET /api/v1/app/projects\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>skip</code> integer 0 Items to skip <code>limit</code> integer 20 Max items (1-100) <code>search</code> string - Search by name <p>Response (200) <pre><code>{\n  \"items\": [\n    {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"name\": \"My Project\",\n      \"description\": \"Project description\",\n      \"owner_id\": \"user_123abc\",\n      \"created_at\": \"2026-01-10T12:00:00Z\",\n      \"updated_at\": \"2026-01-10T12:00:00Z\"\n    }\n  ],\n  \"total\": 1,\n  \"skip\": 0,\n  \"limit\": 20\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#create-project","title":"Create Project","text":"<pre><code>POST /api/v1/app/projects\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"name\": \"New Project\",\n  \"description\": \"Optional description\"\n}\n</code></pre> <p>Request Body</p> Field Type Required Constraints Description <code>name</code> string Yes 1-255 chars Project name <code>description</code> string No max 2000 chars Description <p>Response (201) <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"name\": \"New Project\",\n  \"description\": \"Optional description\",\n  \"owner_id\": \"user_123abc\",\n  \"created_at\": \"2026-01-10T12:00:00Z\",\n  \"updated_at\": \"2026-01-10T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#get-project","title":"Get Project","text":"<pre><code>GET /api/v1/app/projects/{project_id}\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Path Parameters</p> Parameter Type Description <code>project_id</code> string (UUID) Project ID <p>Response (200): Project object</p> <p>Errors - <code>404 NOT_FOUND</code>: Project doesn't exist or user doesn't own it</p>"},{"location":"API-REFERENCE/#update-project","title":"Update Project","text":"<pre><code>PATCH /api/v1/app/projects/{project_id}\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"name\": \"Updated Name\",\n  \"description\": \"Updated description\"\n}\n</code></pre> <p>Request Body</p> Field Type Required Description <code>name</code> string No New name (1-255 chars) <code>description</code> string No New description <p>Response (200): Updated project object</p>"},{"location":"API-REFERENCE/#delete-project","title":"Delete Project","text":"<pre><code>DELETE /api/v1/app/projects/{project_id}\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (204): No content</p> <p>Note: Projects are soft-deleted (marked with <code>deleted_at</code> timestamp).</p>"},{"location":"API-REFERENCE/#file-endpoints","title":"File Endpoints","text":""},{"location":"API-REFERENCE/#get-presigned-upload-url","title":"Get Presigned Upload URL","text":"<pre><code>POST /api/v1/app/files/upload-url\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"filename\": \"document.pdf\",\n  \"content_type\": \"application/pdf\",\n  \"size\": 1048576\n}\n</code></pre> <p>Request Body</p> Field Type Required Description <code>filename</code> string Yes Original filename <code>content_type</code> string Yes MIME type <code>size</code> integer Yes File size in bytes <p>Response (200) <pre><code>{\n  \"upload_url\": \"https://storage.example.com/presigned-upload-url\",\n  \"file_id\": \"file_abc123\",\n  \"key\": \"uploads/user_123/abc123/document.pdf\",\n  \"expires_in\": 3600\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#confirm-upload","title":"Confirm Upload","text":"<pre><code>POST /api/v1/app/files/confirm\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"file_id\": \"file_abc123\"\n}\n</code></pre> <p>Response (200) <pre><code>{\n  \"id\": \"file_abc123\",\n  \"filename\": \"document.pdf\",\n  \"content_type\": \"application/pdf\",\n  \"size\": 1048576,\n  \"status\": \"uploaded\",\n  \"created_at\": \"2026-01-10T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#list-files","title":"List Files","text":"<pre><code>GET /api/v1/app/files\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200): Paginated list of files</p>"},{"location":"API-REFERENCE/#get-download-url","title":"Get Download URL","text":"<pre><code>GET /api/v1/app/files/{file_id}/download-url\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"download_url\": \"https://storage.example.com/presigned-download-url\",\n  \"expires_in\": 3600\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#delete-file","title":"Delete File","text":"<pre><code>DELETE /api/v1/app/files/{file_id}\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (204): No content</p>"},{"location":"API-REFERENCE/#ai-endpoints","title":"AI Endpoints","text":""},{"location":"API-REFERENCE/#get-ai-status","title":"Get AI Status","text":"<pre><code>GET /api/v1/app/ai/status\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"available\": true,\n  \"providers\": [\"openai\", \"anthropic\"],\n  \"default_provider\": \"openai\",\n  \"default_model\": \"gpt-4o\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#chat-completion","title":"Chat Completion","text":"<pre><code>POST /api/v1/app/ai/completions\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"messages\": [\n    { \"role\": \"system\", \"content\": \"You are a helpful assistant.\" },\n    { \"role\": \"user\", \"content\": \"Hello, how are you?\" }\n  ],\n  \"model\": \"gpt-4o\",\n  \"temperature\": 0.7,\n  \"max_tokens\": 1000,\n  \"stream\": false\n}\n</code></pre> <p>Request Body</p> Field Type Required Default Description <code>messages</code> array Yes - Chat messages <code>messages[].role</code> string Yes - <code>system</code>, <code>user</code>, or <code>assistant</code> <code>messages[].content</code> string Yes - Message content <code>model</code> string No <code>gpt-4o</code> Model to use <code>temperature</code> number No 0.7 Creativity (0-2) <code>max_tokens</code> integer No 1000 Max response tokens <code>stream</code> boolean No false Enable streaming <p>Response (200) <pre><code>{\n  \"content\": \"Hello! I'm doing well, thank you for asking.\",\n  \"model\": \"gpt-4o\",\n  \"provider\": \"openai\",\n  \"usage\": {\n    \"prompt_tokens\": 25,\n    \"completion_tokens\": 12,\n    \"total_tokens\": 37\n  },\n  \"finish_reason\": \"stop\",\n  \"latency_ms\": 450.5\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#simple-chat","title":"Simple Chat","text":"<pre><code>POST /api/v1/app/ai/chat\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"prompt\": \"Explain quantum computing in one sentence.\",\n  \"system\": \"You are a physics teacher.\",\n  \"temperature\": 0.5\n}\n</code></pre> <p>Request Body</p> Field Type Required Description <code>prompt</code> string Yes User prompt <code>system</code> string No System instruction <code>model</code> string No Model to use <code>temperature</code> number No Creativity (0-2) <code>max_tokens</code> integer No Max response tokens <code>stream</code> boolean No Enable streaming"},{"location":"API-REFERENCE/#routed-chat-auto-model-selection","title":"Routed Chat (Auto Model Selection)","text":"<pre><code>POST /api/v1/app/ai/chat/routed\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"prompt\": \"Solve this complex coding problem...\",\n  \"complexity\": \"complex\"\n}\n</code></pre> <p>Complexity Levels</p> Level Model Used Best For <code>simple</code> gpt-4o-mini Classification, extraction <code>moderate</code> gpt-4o Summarization, analysis <code>complex</code> claude-sonnet Reasoning, coding <code>search</code> Perplexity Current information"},{"location":"API-REFERENCE/#streaming-response","title":"Streaming Response","text":"<p>When <code>stream: true</code>, response is Server-Sent Events:</p> <pre><code>data: Hello\ndata:  world\ndata: !\ndata: [DONE]\n</code></pre>"},{"location":"API-REFERENCE/#billing-endpoints","title":"Billing Endpoints","text":""},{"location":"API-REFERENCE/#get-billing-status","title":"Get Billing Status","text":"<pre><code>GET /api/v1/app/billing/status\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"plan\": \"pro\",\n  \"status\": \"active\",\n  \"current_period_end\": \"2026-02-10T12:00:00Z\",\n  \"cancel_at_period_end\": false,\n  \"has_active_subscription\": true\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#create-checkout-session","title":"Create Checkout Session","text":"<pre><code>POST /api/v1/app/billing/checkout\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"plan\": \"monthly\",\n  \"success_url\": \"https://app.example.com/billing/success\",\n  \"cancel_url\": \"https://app.example.com/billing/cancel\"\n}\n</code></pre> <p>Request Body</p> Field Type Required Description <code>plan</code> string Yes <code>monthly</code> or <code>yearly</code> <code>success_url</code> string Yes Redirect on success <code>cancel_url</code> string Yes Redirect on cancel <p>Response (200) <pre><code>{\n  \"session_id\": \"cs_xxx\",\n  \"url\": \"https://checkout.stripe.com/pay/cs_xxx\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#get-billing-portal","title":"Get Billing Portal","text":"<pre><code>GET /api/v1/app/billing/portal?return_url=https://app.example.com/settings\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"url\": \"https://billing.stripe.com/session/xxx\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#get-invoices","title":"Get Invoices","text":"<pre><code>GET /api/v1/app/billing/invoices?limit=10\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>[\n  {\n    \"id\": \"in_xxx\",\n    \"number\": \"INV-0001\",\n    \"status\": \"paid\",\n    \"amount_due\": 1999,\n    \"amount_paid\": 1999,\n    \"currency\": \"usd\",\n    \"created\": 1704067200,\n    \"hosted_invoice_url\": \"https://invoice.stripe.com/xxx\",\n    \"invoice_pdf\": \"https://pay.stripe.com/invoice/xxx/pdf\"\n  }\n]\n</code></pre></p>"},{"location":"API-REFERENCE/#cancel-subscription","title":"Cancel Subscription","text":"<pre><code>POST /api/v1/app/billing/cancel?immediate=false\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>immediate</code> boolean false Cancel immediately (no refund) <p>Response (200) <pre><code>{\n  \"message\": \"Subscription will cancel at the end of the billing period\",\n  \"cancel_at_period_end\": true,\n  \"current_period_end\": \"2026-02-10T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#resume-subscription","title":"Resume Subscription","text":"<pre><code>POST /api/v1/app/billing/resume\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <p>Response (200) <pre><code>{\n  \"message\": \"Subscription resumed\",\n  \"status\": \"active\",\n  \"plan\": \"pro\"\n}\n</code></pre></p>"},{"location":"API-REFERENCE/#admin-endpoints","title":"Admin Endpoints","text":"<p>Note: All admin endpoints require <code>Authorization</code> header AND user must have <code>admin</code> or <code>superadmin</code> role.</p>"},{"location":"API-REFERENCE/#list-all-users","title":"List All Users","text":"<pre><code>GET /api/v1/admin/users?skip=0&amp;limit=20\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre> <p>Response (200): Paginated list of users with admin details</p>"},{"location":"API-REFERENCE/#get-user-by-id","title":"Get User by ID","text":"<pre><code>GET /api/v1/admin/users/{user_id}\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#update-user-admin","title":"Update User (Admin)","text":"<pre><code>PATCH /api/v1/admin/users/{user_id}\nAuthorization: Bearer &lt;admin_token&gt;\nContent-Type: application/json\n\n{\n  \"role\": \"admin\",\n  \"is_active\": true\n}\n</code></pre>"},{"location":"API-REFERENCE/#deactivate-user","title":"Deactivate User","text":"<pre><code>POST /api/v1/admin/users/{user_id}/deactivate\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#activate-user","title":"Activate User","text":"<pre><code>POST /api/v1/admin/users/{user_id}/activate\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#list-background-jobs","title":"List Background Jobs","text":"<pre><code>GET /api/v1/admin/jobs\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#retry-failed-job","title":"Retry Failed Job","text":"<pre><code>POST /api/v1/admin/jobs/{job_id}/retry\nAuthorization: Bearer &lt;admin_token&gt;\n</code></pre>"},{"location":"API-REFERENCE/#webhook-endpoints","title":"Webhook Endpoints","text":"<p>Note: Webhook endpoints don't require Bearer authentication. They verify requests using provider-specific signatures.</p>"},{"location":"API-REFERENCE/#stripe-webhook","title":"Stripe Webhook","text":"<pre><code>POST /api/v1/public/webhooks/stripe\nStripe-Signature: t=xxx,v1=xxx\n</code></pre> <p>Handled Events - <code>checkout.session.completed</code> - New subscription - <code>customer.subscription.updated</code> - Plan change - <code>customer.subscription.deleted</code> - Cancellation - <code>invoice.paid</code> - Successful payment - <code>invoice.payment_failed</code> - Failed payment</p>"},{"location":"API-REFERENCE/#clerk-webhook","title":"Clerk Webhook","text":"<pre><code>POST /api/v1/public/webhooks/clerk\nsvix-id: xxx\nsvix-timestamp: xxx\nsvix-signature: xxx\n</code></pre> <p>Handled Events - <code>user.created</code> - New user signup - <code>user.updated</code> - Profile update - <code>user.deleted</code> - User deletion</p>"},{"location":"API-REFERENCE/#supabase-webhook","title":"Supabase Webhook","text":"<pre><code>POST /api/v1/public/webhooks/supabase\nAuthorization: Bearer &lt;webhook_secret&gt;\n</code></pre> <p>Handled Events - <code>INSERT</code> on <code>auth.users</code> - New user - <code>UPDATE</code> on <code>auth.users</code> - User update - <code>DELETE</code> on <code>auth.users</code> - User deletion</p>"},{"location":"API-REFERENCE/#apple-app-store-webhook","title":"Apple App Store Webhook","text":"<pre><code>POST /api/v1/public/webhooks/apple\nContent-Type: application/json\n\n{\n  \"signedPayload\": \"&lt;JWS_signed_notification&gt;\"\n}\n</code></pre> <p>Handled Events - <code>SUBSCRIBED</code> - New subscription - <code>DID_RENEW</code> - Renewal - <code>EXPIRED</code> - Expiration - <code>REFUND</code> - Refund issued</p>"},{"location":"API-REFERENCE/#google-play-webhook","title":"Google Play Webhook","text":"<pre><code>POST /api/v1/public/webhooks/google\nContent-Type: application/json\n\n{\n  \"message\": {\n    \"data\": \"&lt;base64_encoded_notification&gt;\",\n    \"messageId\": \"xxx\"\n  }\n}\n</code></pre> <p>Handled Events - <code>SUBSCRIPTION_PURCHASED</code> - New subscription - <code>SUBSCRIPTION_RENEWED</code> - Renewal - <code>SUBSCRIPTION_CANCELED</code> - Cancellation - <code>SUBSCRIPTION_EXPIRED</code> - Expiration</p>"},{"location":"API-REFERENCE/#response-headers","title":"Response Headers","text":""},{"location":"API-REFERENCE/#standard-headers","title":"Standard Headers","text":"<p>Every response includes:</p> Header Description <code>X-Request-ID</code> Unique request identifier for debugging <code>X-RateLimit-Limit</code> Rate limit ceiling <code>X-RateLimit-Remaining</code> Remaining requests <code>X-RateLimit-Reset</code> Reset timestamp"},{"location":"API-REFERENCE/#security-headers-production","title":"Security Headers (Production)","text":"Header Value <code>X-Content-Type-Options</code> <code>nosniff</code> <code>X-Frame-Options</code> <code>DENY</code> <code>Strict-Transport-Security</code> <code>max-age=31536000; includeSubDomains</code> <code>Content-Security-Policy</code> <code>default-src 'self'</code>"},{"location":"API-REFERENCE/#openapi-swagger","title":"OpenAPI / Swagger","text":"<p>Interactive API documentation is available at:</p> <ul> <li>Swagger UI: <code>http://localhost:8000/docs</code></li> <li>ReDoc: <code>http://localhost:8000/redoc</code></li> <li>OpenAPI JSON: <code>http://localhost:8000/openapi.json</code></li> </ul>"},{"location":"ARCHITECTURE/","title":"Architecture Documentation","text":"<p>Complete guide to the system architecture, design patterns, and code conventions.</p>"},{"location":"ARCHITECTURE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Design Principles</li> <li>Project Structure</li> <li>Naming Conventions</li> <li>Request Lifecycle</li> <li>Layer Architecture</li> <li>Database Patterns</li> <li>Authentication Flow</li> <li>Error Handling</li> <li>Service Adapters</li> <li>Adding New Features</li> </ol>"},{"location":"ARCHITECTURE/#design-principles","title":"Design Principles","text":""},{"location":"ARCHITECTURE/#1-12-factor-app-compliance","title":"1. 12-Factor App Compliance","text":"<p>All configuration via environment variables. No hardcoded secrets or config.</p>"},{"location":"ARCHITECTURE/#2-adapter-pattern","title":"2. Adapter Pattern","text":"<p>External services (AI, email, storage) are plugins with abstract interfaces. Swap providers without changing business logic.</p>"},{"location":"ARCHITECTURE/#3-clean-architecture","title":"3. Clean Architecture","text":"<p>Business logic has zero knowledge of HTTP or frameworks. Pure Python functions that can be tested in isolation.</p>"},{"location":"ARCHITECTURE/#4-async-first","title":"4. Async-First","text":"<p>All I/O operations are non-blocking. Use <code>async</code>/<code>await</code> everywhere.</p>"},{"location":"ARCHITECTURE/#5-fail-fast","title":"5. Fail-Fast","text":"<p>Invalid configuration fails at startup, not runtime. Better to fail early than produce silent errors.</p>"},{"location":"ARCHITECTURE/#6-convention-over-configuration","title":"6. Convention Over Configuration","text":"<p>Consistent patterns reduce cognitive load. Follow the established conventions.</p>"},{"location":"ARCHITECTURE/#project-structure","title":"Project Structure","text":"<pre><code>app/\n\u251c\u2500\u2500 main.py                    # FastAPI application factory\n\u251c\u2500\u2500 __init__.py\n\u2502\n\u251c\u2500\u2500 api/                       # HTTP Layer (Controllers)\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 deps.py                # Dependency injection\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 router.py          # Route aggregation\n\u2502       \u251c\u2500\u2500 public/            # No auth required\n\u2502       \u2502   \u251c\u2500\u2500 health.py      # Health checks\n\u2502       \u2502   \u251c\u2500\u2500 webhooks.py    # External webhooks\n\u2502       \u2502   \u2514\u2500\u2500 metrics.py     # Prometheus metrics\n\u2502       \u251c\u2500\u2500 app/               # Auth required\n\u2502       \u2502   \u251c\u2500\u2500 users.py       # User endpoints\n\u2502       \u2502   \u251c\u2500\u2500 projects.py    # Project CRUD\n\u2502       \u2502   \u251c\u2500\u2500 files.py       # File management\n\u2502       \u2502   \u251c\u2500\u2500 ai.py          # AI completions\n\u2502       \u2502   \u2514\u2500\u2500 billing.py     # Subscriptions\n\u2502       \u2514\u2500\u2500 admin/             # Admin role required\n\u2502           \u251c\u2500\u2500 users.py       # User management\n\u2502           \u2514\u2500\u2500 jobs.py        # Job monitoring\n\u2502\n\u251c\u2500\u2500 core/                      # Core Infrastructure\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 config.py              # Pydantic Settings\n\u2502   \u251c\u2500\u2500 db.py                  # Database engine &amp; session\n\u2502   \u251c\u2500\u2500 cache.py               # Redis client\n\u2502   \u251c\u2500\u2500 security.py            # JWT verification\n\u2502   \u251c\u2500\u2500 exceptions.py          # Custom exceptions\n\u2502   \u251c\u2500\u2500 middleware.py          # HTTP middleware\n\u2502   \u251c\u2500\u2500 sentry.py              # Error tracking\n\u2502   \u251c\u2500\u2500 metrics.py             # Prometheus metrics\n\u2502   \u2514\u2500\u2500 logging.py             # Structured logging\n\u2502\n\u251c\u2500\u2500 models/                    # Database Models (SQLModel)\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 base.py                # BaseModel, SoftDeleteMixin\n\u2502   \u251c\u2500\u2500 user.py                # User model + schemas\n\u2502   \u251c\u2500\u2500 project.py             # Project model\n\u2502   \u251c\u2500\u2500 file.py                # File model\n\u2502   \u2514\u2500\u2500 webhook_event.py       # Webhook tracking\n\u2502\n\u251c\u2500\u2500 schemas/                   # Request/Response Schemas\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 common.py              # Shared schemas\n\u2502   \u251c\u2500\u2500 user.py                # User schemas (re-exports)\n\u2502   \u251c\u2500\u2500 project.py             # Project schemas\n\u2502   \u251c\u2500\u2500 file.py                # File schemas\n\u2502   \u2514\u2500\u2500 ai.py                  # AI schemas\n\u2502\n\u251c\u2500\u2500 business/                  # Business Logic Layer\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 crud_base.py           # Generic CRUD operations\n\u2502   \u251c\u2500\u2500 user_service.py        # User business logic\n\u2502   \u251c\u2500\u2500 project_service.py     # Project business logic\n\u2502   \u251c\u2500\u2500 billing_service.py     # Billing business logic\n\u2502   \u2514\u2500\u2500 iap_service.py         # Mobile IAP logic\n\u2502\n\u251c\u2500\u2500 services/                  # External Service Adapters\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 ai/                    # AI providers\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 base.py            # Abstract interface\n\u2502   \u2502   \u251c\u2500\u2500 openai_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 anthropic_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 gemini_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 router.py          # Smart routing\n\u2502   \u2502   \u2514\u2500\u2500 factory.py         # Provider factory\n\u2502   \u251c\u2500\u2500 email/                 # Email providers\n\u2502   \u2502   \u251c\u2500\u2500 base.py\n\u2502   \u2502   \u251c\u2500\u2500 resend_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 sendgrid_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 console_provider.py\n\u2502   \u2502   \u2514\u2500\u2500 factory.py\n\u2502   \u251c\u2500\u2500 storage/               # Storage providers\n\u2502   \u2502   \u251c\u2500\u2500 base.py\n\u2502   \u2502   \u251c\u2500\u2500 s3_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 r2_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 cloudinary_provider.py\n\u2502   \u2502   \u251c\u2500\u2500 local_provider.py\n\u2502   \u2502   \u2514\u2500\u2500 factory.py\n\u2502   \u2514\u2500\u2500 payments/              # Payment providers\n\u2502       \u251c\u2500\u2500 stripe_service.py\n\u2502       \u251c\u2500\u2500 apple_iap_service.py\n\u2502       \u2514\u2500\u2500 google_iap_service.py\n\u2502\n\u251c\u2500\u2500 jobs/                      # Background Tasks\n\u2502   \u251c\u2500\u2500 __init__.py            # Enqueue utilities\n\u2502   \u251c\u2500\u2500 worker.py              # ARQ worker config\n\u2502   \u251c\u2500\u2500 decorators.py          # @retry, @timeout\n\u2502   \u251c\u2500\u2500 email_jobs.py          # Email tasks\n\u2502   \u2514\u2500\u2500 report_jobs.py         # Report tasks\n\u2502\n\u2514\u2500\u2500 utils/                     # Utility Functions\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 pagination.py          # Pagination helpers\n    \u251c\u2500\u2500 validators.py          # Input validation\n    \u251c\u2500\u2500 crypto.py              # Cryptographic utils\n    \u2514\u2500\u2500 resilience.py          # Circuit breaker, retry\n</code></pre>"},{"location":"ARCHITECTURE/#naming-conventions","title":"Naming Conventions","text":""},{"location":"ARCHITECTURE/#files","title":"Files","text":"Type Convention Example Models Singular, snake_case <code>user.py</code>, <code>project.py</code> Schemas Same as model <code>user.py</code>, <code>project.py</code> Services Singular + <code>_service</code> <code>user_service.py</code> Providers Provider name + <code>_provider</code> <code>openai_provider.py</code> Endpoints Plural, snake_case <code>users.py</code>, <code>projects.py</code> Tests <code>test_</code> + module name <code>test_users.py</code>"},{"location":"ARCHITECTURE/#classes","title":"Classes","text":"Type Convention Example Models PascalCase, singular <code>User</code>, <code>Project</code> Schemas PascalCase + action <code>UserCreate</code>, <code>UserUpdate</code>, <code>UserRead</code> Services PascalCase + <code>Service</code> <code>BillingService</code> Providers Provider + <code>Provider</code> <code>OpenAIProvider</code> Exceptions PascalCase + <code>Error</code> <code>NotFoundError</code>"},{"location":"ARCHITECTURE/#functions","title":"Functions","text":"Type Convention Example Endpoints verb_noun (snake_case) <code>list_projects</code>, <code>create_project</code> Services action_object <code>get_user</code>, <code>create_project</code> Helpers descriptive snake_case <code>parse_jwt_token</code> Async Same + async <code>async def get_user()</code>"},{"location":"ARCHITECTURE/#variables","title":"Variables","text":"Type Convention Example Local snake_case <code>user_id</code>, <code>project_name</code> Constants UPPER_SNAKE_CASE <code>MAX_RETRIES</code>, <code>DEFAULT_LIMIT</code> Private _underscore prefix <code>_cache</code>, <code>_pool</code> Type vars PascalCase <code>ModelType</code>, <code>T</code>"},{"location":"ARCHITECTURE/#database","title":"Database","text":"Type Convention Example Table names Plural, snake_case <code>users</code>, <code>projects</code> Column names snake_case <code>created_at</code>, <code>owner_id</code> Foreign keys referenced_table_id <code>user_id</code>, <code>project_id</code> Indexes table_column_idx <code>users_email_idx</code>"},{"location":"ARCHITECTURE/#api-routes","title":"API Routes","text":"Convention Example Plural nouns <code>/projects</code>, <code>/users</code> Lowercase, hyphenated <code>/billing/checkout</code> No trailing slash <code>/projects</code> not <code>/projects/</code> Resource ID in path <code>/projects/{project_id}</code> Actions as sub-resources <code>/users/{id}/deactivate</code>"},{"location":"ARCHITECTURE/#http-methods","title":"HTTP Methods","text":"Method Purpose Endpoint Example GET Read <code>GET /projects</code> POST Create <code>POST /projects</code> PATCH Partial update <code>PATCH /projects/{id}</code> DELETE Remove <code>DELETE /projects/{id}</code> <p>Note: We use <code>PATCH</code> instead of <code>PUT</code> because all update fields are optional.</p>"},{"location":"ARCHITECTURE/#request-lifecycle","title":"Request Lifecycle","text":"<pre><code>                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502    Incoming Request     \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502    CORS Middleware      \u2502\n                                    \u2502 (Check allowed origins) \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Request ID Middleware  \u2502\n                                    \u2502  (Add X-Request-ID)     \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Rate Limit Middleware  \u2502\n                                    \u2502  (Check/update limits)  \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Logging Middleware    \u2502\n                                    \u2502  (Log request start)    \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502    Route Matching       \u2502\n                                    \u2502  (FastAPI router)       \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502                                   \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  Public Routes    \u2502              \u2502  Protected Routes \u2502\n                    \u2502  (No auth)        \u2502              \u2502  (Auth required)  \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502                                   \u2502\n                              \u2502                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502                        \u2502  JWT Verification   \u2502\n                              \u2502                        \u2502  (verify_token)     \u2502\n                              \u2502                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502                                   \u2502\n                              \u2502                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502                        \u2502  User Resolution    \u2502\n                              \u2502                        \u2502  (get_current_user) \u2502\n                              \u2502                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502                                   \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   DB Session Created    \u2502\n                                    \u2502   (Dependency)          \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Request Validation     \u2502\n                                    \u2502  (Pydantic schemas)     \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Business Logic        \u2502\n                                    \u2502   (Service layer)       \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Database Operations   \u2502\n                                    \u2502   (CRUD operations)     \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Response Serialized   \u2502\n                                    \u2502   (Pydantic model)      \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   DB Session Commit     \u2502\n                                    \u2502   (Auto on success)     \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Security Headers       \u2502\n                                    \u2502  (Middleware)           \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Logging Middleware    \u2502\n                                    \u2502   (Log response)        \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                \u2502\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Response Sent         \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE/#layer-architecture","title":"Layer Architecture","text":""},{"location":"ARCHITECTURE/#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           API Layer (HTTP)                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Endpoints (app/api/v1/)                                         \u2502   \u2502\n\u2502   \u2502  - Route handlers                                                \u2502   \u2502\n\u2502   \u2502  - Request/response serialization                                \u2502   \u2502\n\u2502   \u2502  - HTTP-specific logic only                                      \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Dependencies (app/api/deps.py)                                  \u2502   \u2502\n\u2502   \u2502  - Authentication                                                \u2502   \u2502\n\u2502   \u2502  - Database session                                              \u2502   \u2502\n\u2502   \u2502  - Current user resolution                                       \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Business Layer (Pure Python)                     \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Services (app/business/)                                        \u2502   \u2502\n\u2502   \u2502  - Business rules                                                \u2502   \u2502\n\u2502   \u2502  - Orchestration logic                                           \u2502   \u2502\n\u2502   \u2502  - No HTTP knowledge                                             \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  CRUD Base (app/business/crud_base.py)                           \u2502   \u2502\n\u2502   \u2502  - Generic database operations                                   \u2502   \u2502\n\u2502   \u2502  - Reusable across models                                        \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Data Layer (Database)                           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Models (app/models/)                                            \u2502   \u2502\n\u2502   \u2502  - SQLModel table definitions                                    \u2502   \u2502\n\u2502   \u2502  - Database schema                                               \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                   \u2502                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502   \u2502  Database (app/core/db.py)                                       \u2502   \u2502\n\u2502   \u2502  - Connection pool                                               \u2502   \u2502\n\u2502   \u2502  - Session management                                            \u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       External Services (Adapters)                       \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502     AI     \u2502  \u2502   Email    \u2502  \u2502  Storage   \u2502  \u2502  Payments  \u2502       \u2502\n\u2502   \u2502  Gateway   \u2502  \u2502  Service   \u2502  \u2502  Service   \u2502  \u2502  Service   \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE/#api-layer-appapi","title":"API Layer (<code>app/api/</code>)","text":"<p>Responsibilities: - Route definition - Request validation (automatic via Pydantic) - Response serialization - HTTP status codes - Dependency injection</p> <p>Rules: - No business logic - No direct database queries - Call services for all operations - Keep endpoints thin</p> <pre><code># Good - thin endpoint\n@router.post(\"\", response_model=ProjectRead, status_code=status.HTTP_201_CREATED)\nasync def create_project(\n    session: DBSession,\n    user: CurrentUser,\n    project_in: ProjectCreate,\n):\n    \"\"\"Create a new project.\"\"\"\n    return await project_service.create_with_owner(\n        session, obj_in=project_in, owner_id=user.id\n    )\n\n# Bad - business logic in endpoint\n@router.post(\"\")\nasync def create_project(session: DBSession, user: CurrentUser, project_in: ProjectCreate):\n    # Don't do this in the endpoint!\n    if await session.execute(select(Project).where(Project.name == project_in.name)):\n        raise HTTPException(...)\n    project = Project(**project_in.model_dump(), owner_id=user.id)\n    session.add(project)\n    # ...\n</code></pre>"},{"location":"ARCHITECTURE/#business-layer-appbusiness","title":"Business Layer (<code>app/business/</code>)","text":"<p>Responsibilities: - Business rules and validation - Orchestration of operations - Transaction boundaries - Domain-specific logic</p> <p>Rules: - No HTTP concepts (status codes, requests) - Can call other services - Can use external service adapters - Raise domain exceptions, not HTTP exceptions</p> <pre><code># Good - pure business logic\nclass ProjectService(CRUDBase[Project, ProjectCreate, ProjectUpdate]):\n    async def create_with_owner(\n        self,\n        session: AsyncSession,\n        *,\n        obj_in: ProjectCreate,\n        owner_id: str,\n    ) -&gt; Project:\n        \"\"\"Create project with ownership.\"\"\"\n        return await super().create_with_owner(session, obj_in=obj_in, owner_id=owner_id)\n\n    async def get_active_by_owner(\n        self,\n        session: AsyncSession,\n        *,\n        owner_id: str,\n        skip: int = 0,\n        limit: int = 100,\n    ) -&gt; list[Project]:\n        \"\"\"Get non-deleted projects for owner.\"\"\"\n        result = await session.execute(\n            select(self.model)\n            .where(self.model.owner_id == owner_id)\n            .where(self.model.deleted_at.is_(None))\n            .offset(skip)\n            .limit(limit)\n        )\n        return list(result.scalars().all())\n</code></pre>"},{"location":"ARCHITECTURE/#data-layer-appmodels","title":"Data Layer (<code>app/models/</code>)","text":"<p>Responsibilities: - Database schema definition - Relationships - Table constraints</p> <p>Rules: - No business logic - Only data structure definition - Use SQLModel for type safety</p> <pre><code># Model definition\nclass Project(BaseModel, SoftDeleteMixin, table=True):\n    __tablename__ = \"projects\"\n\n    name: str = Field(max_length=255, index=True)\n    description: str | None = Field(default=None, max_length=2000)\n    owner_id: str = Field(foreign_key=\"users.id\", index=True)\n</code></pre>"},{"location":"ARCHITECTURE/#database-patterns","title":"Database Patterns","text":""},{"location":"ARCHITECTURE/#base-model","title":"Base Model","text":"<p>All models inherit from <code>BaseModel</code>:</p> <pre><code>class BaseModel(SQLModel):\n    id: str = Field(\n        default_factory=lambda: str(uuid.uuid4()),\n        primary_key=True,\n        index=True,\n    )\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n</code></pre>"},{"location":"ARCHITECTURE/#soft-delete","title":"Soft Delete","text":"<p>Models with <code>SoftDeleteMixin</code> are never actually deleted:</p> <pre><code>class SoftDeleteMixin(SQLModel):\n    deleted_at: datetime | None = Field(default=None)\n\n    @property\n    def is_deleted(self) -&gt; bool:\n        return self.deleted_at is not None\n</code></pre> <p>Always filter out deleted records:</p> <pre><code># In queries\n.where(Model.deleted_at.is_(None))\n\n# In service\nawait project_service.soft_delete(session, id=project_id)\n</code></pre>"},{"location":"ARCHITECTURE/#generic-crud","title":"Generic CRUD","text":"<p>Use <code>CRUDBase</code> for common operations:</p> <pre><code>from app.business.crud_base import CRUDBase\n\nclass ProjectService(CRUDBase[Project, ProjectCreate, ProjectUpdate]):\n    pass\n\nproject_service = ProjectService(Project)\n\n# Available methods:\nawait project_service.get(session, id=id)\nawait project_service.get_multi(session, skip=0, limit=20)\nawait project_service.get_multi_by_owner(session, owner_id=user.id)\nawait project_service.create(session, obj_in=create_schema)\nawait project_service.create_with_owner(session, obj_in=schema, owner_id=user.id)\nawait project_service.update(session, db_obj=project, obj_in=update_schema)\nawait project_service.delete(session, id=id)\nawait project_service.soft_delete(session, id=id)\nawait project_service.restore(session, id=id)\n</code></pre>"},{"location":"ARCHITECTURE/#session-management","title":"Session Management","text":"<p>Database sessions are automatically managed:</p> <pre><code>@router.get(\"\")\nasync def list_items(session: DBSession):\n    # Session auto-commits on success\n    # Session auto-rollbacks on exception\n    items = await item_service.get_multi(session)\n    return items\n</code></pre>"},{"location":"ARCHITECTURE/#authentication-flow","title":"Authentication Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Frontend     \u2502     \u2502  Auth Provider  \u2502     \u2502    Backend      \u2502\n\u2502   (React/Vue)   \u2502     \u2502 (Supabase/Clerk)\u2502     \u2502   (FastAPI)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                       \u2502                       \u2502\n         \u2502  1. Login             \u2502                       \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502                       \u2502\n         \u2502                       \u2502                       \u2502\n         \u2502  2. JWT Token         \u2502                       \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                       \u2502\n         \u2502                       \u2502                       \u2502\n         \u2502  3. API Request       \u2502                       \u2502\n         \u2502  Authorization: Bearer &lt;token&gt;                \u2502\n         \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                       \u2502                       \u2502\n         \u2502                       \u2502  4. Verify JWT        \u2502\n         \u2502                       \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                       \u2502  (via JWKS)           \u2502\n         \u2502                       \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502\n         \u2502                       \u2502                       \u2502\n         \u2502                       \u2502                       \u2502 5. Get/Create User\n         \u2502                       \u2502                       \u2502    (from DB)\n         \u2502                       \u2502                       \u2502\n         \u2502  6. Response          \u2502                       \u2502\n         \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n         \u2502                       \u2502                       \u2502\n</code></pre>"},{"location":"ARCHITECTURE/#code-flow","title":"Code Flow","text":"<pre><code># 1. Dependency injection in endpoint\n@router.get(\"/me\")\nasync def get_me(\n    session: DBSession,          # Database session\n    user: CurrentUser,            # Resolved user object\n) -&gt; UserRead:\n    return user\n\n# 2. CurrentUser dependency chain\nCurrentUser = Annotated[User, Depends(get_current_user)]\n\n# 3. get_current_user resolution\nasync def get_current_user(\n    session: DBSession,\n    user_id: CurrentUserId,      # From JWT 'sub' claim\n    payload: TokenPayload,        # Full JWT payload\n) -&gt; User:\n    user = await sync_user_from_token(session, user_id, payload)\n    if not user.is_active:\n        raise HTTPException(status_code=403, detail=\"User deactivated\")\n    return user\n\n# 4. Token verification\ndef verify_token(credentials: HTTPAuthorizationCredentials) -&gt; dict:\n    token = credentials.credentials\n    # Verify with JWKS (RS256) or secret (HS256)\n    payload = jwt.decode(token, key=key, algorithms=[algorithm])\n    return payload\n</code></pre>"},{"location":"ARCHITECTURE/#error-handling","title":"Error Handling","text":""},{"location":"ARCHITECTURE/#custom-exceptions","title":"Custom Exceptions","text":"<pre><code># Define in app/core/exceptions.py\nclass NotFoundError(AppException):\n    def __init__(self, resource: str, id: str):\n        super().__init__(\n            message=f\"{resource} not found\",\n            code=\"NOT_FOUND\",\n            status_code=404,\n            details={\"resource\": resource, \"id\": id},\n        )\n\n# Use in service/endpoint\nraise NotFoundError(\"Project\", project_id)\n</code></pre>"},{"location":"ARCHITECTURE/#exception-handler","title":"Exception Handler","text":"<p>Global handler converts exceptions to JSON:</p> <pre><code># Returns:\n{\n  \"error\": {\n    \"code\": \"NOT_FOUND\",\n    \"message\": \"Project not found\",\n    \"details\": {\"resource\": \"Project\", \"id\": \"123\"}\n  }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#exception-types","title":"Exception Types","text":"Exception Status When to Use <code>NotFoundError</code> 404 Resource doesn't exist <code>ValidationError</code> 422 Invalid input data <code>AuthenticationError</code> 401 Missing/invalid token <code>AuthorizationError</code> 403 Insufficient permissions <code>ConflictError</code> 409 Duplicate entry <code>RateLimitError</code> 429 Too many requests <code>ExternalServiceError</code> 502 External API failed <code>ServiceUnavailableError</code> 503 Service not configured"},{"location":"ARCHITECTURE/#service-adapters","title":"Service Adapters","text":""},{"location":"ARCHITECTURE/#pattern-abstract-interface-implementations","title":"Pattern: Abstract Interface + Implementations","text":"<pre><code># 1. Abstract base (app/services/email/base.py)\nclass BaseEmailService(ABC):\n    @abstractmethod\n    async def send(self, to: str, subject: str, template: str, data: dict) -&gt; bool:\n        pass\n\n# 2. Implementation (app/services/email/resend_provider.py)\nclass ResendEmailService(BaseEmailService):\n    async def send(self, to: str, subject: str, template: str, data: dict) -&gt; bool:\n        # Resend-specific implementation\n        ...\n\n# 3. Factory (app/services/email/factory.py)\n@lru_cache(maxsize=1)\ndef get_email_service() -&gt; BaseEmailService:\n    if settings.EMAIL_PROVIDER == \"resend\":\n        return ResendEmailService()\n    elif settings.EMAIL_PROVIDER == \"sendgrid\":\n        return SendGridEmailService()\n    return ConsoleEmailService()  # Default fallback\n</code></pre>"},{"location":"ARCHITECTURE/#available-service-adapters","title":"Available Service Adapters","text":"Service Providers Config Email Resend, SendGrid, Console <code>EMAIL_PROVIDER</code> Storage S3, R2, Cloudinary, Local <code>STORAGE_PROVIDER</code> AI OpenAI, Anthropic, Gemini <code>AI_DEFAULT_PROVIDER</code> Payments Stripe, Apple IAP, Google Play N/A"},{"location":"ARCHITECTURE/#adding-new-features","title":"Adding New Features","text":""},{"location":"ARCHITECTURE/#adding-a-new-endpoint","title":"Adding a New Endpoint","text":"<ol> <li>Create/update schema (<code>app/schemas/</code>)</li> <li>Create/update model if needed (<code>app/models/</code>)</li> <li>Create/update service (<code>app/business/</code>)</li> <li>Create endpoint (<code>app/api/v1/</code>)</li> <li>Register router (<code>app/api/v1/router.py</code>)</li> <li>Add tests (<code>tests/</code>)</li> </ol>"},{"location":"ARCHITECTURE/#example-adding-a-task-resource","title":"Example: Adding a \"Task\" Resource","text":"<pre><code># 1. Model (app/models/task.py)\nclass Task(BaseModel, SoftDeleteMixin, table=True):\n    __tablename__ = \"tasks\"\n    title: str = Field(max_length=255)\n    completed: bool = Field(default=False)\n    project_id: str = Field(foreign_key=\"projects.id\")\n\n# 2. Schema (app/schemas/task.py)\nclass TaskCreate(SQLModel):\n    title: str = Field(min_length=1, max_length=255)\n    project_id: str\n\nclass TaskUpdate(SQLModel):\n    title: str | None = None\n    completed: bool | None = None\n\nclass TaskRead(SQLModel):\n    id: str\n    title: str\n    completed: bool\n    project_id: str\n    created_at: datetime\n\n# 3. Service (app/business/task_service.py)\nclass TaskService(CRUDBase[Task, TaskCreate, TaskUpdate]):\n    async def get_by_project(\n        self, session: AsyncSession, *, project_id: str\n    ) -&gt; list[Task]:\n        result = await session.execute(\n            select(self.model).where(self.model.project_id == project_id)\n        )\n        return list(result.scalars().all())\n\ntask_service = TaskService(Task)\n\n# 4. Endpoint (app/api/v1/app/tasks.py)\nrouter = APIRouter(tags=[\"Tasks\"])\n\n@router.get(\"\", response_model=list[TaskRead])\nasync def list_tasks(\n    session: DBSession,\n    user: CurrentUser,\n    project_id: str = Query(...),\n):\n    # Verify user owns project\n    project = await project_service.get(session, id=project_id)\n    if not project or project.owner_id != user.id:\n        raise NotFoundError(\"Project\", project_id)\n\n    return await task_service.get_by_project(session, project_id=project_id)\n\n# 5. Register (app/api/v1/router.py)\nfrom app.api.v1.app import tasks\napp_router.include_router(tasks.router, prefix=\"/tasks\")\n</code></pre>"},{"location":"ARCHITECTURE/#adding-a-new-external-service","title":"Adding a New External Service","text":"<ol> <li>Create base interface (<code>app/services/myservice/base.py</code>)</li> <li>Create implementations (<code>app/services/myservice/provider.py</code>)</li> <li>Create factory (<code>app/services/myservice/factory.py</code>)</li> <li>Add config (<code>app/core/config.py</code>)</li> <li>Document environment variables</li> </ol>"},{"location":"ARCHITECTURE/#cicd-pipelines","title":"CI/CD Pipelines","text":""},{"location":"ARCHITECTURE/#ci-pipeline-githubworkflowsciyml","title":"CI Pipeline (<code>.github/workflows/ci.yml</code>)","text":"<pre><code>Jobs:\n1. Lint (ruff check, ruff format)\n2. Type check (mypy)\n3. Unit tests (pytest tests/unit)\n4. Integration tests (pytest tests/integration)\n5. Build Docker image\n6. Security scan (bandit)\n</code></pre>"},{"location":"ARCHITECTURE/#deploy-pipeline-githubworkflowsdeployyml","title":"Deploy Pipeline (<code>.github/workflows/deploy.yml</code>)","text":"<pre><code>Stages:\n1. Build \u2192 Push to registry\n2. Deploy to staging\n3. Run smoke tests\n4. Deploy to production\n5. Create Sentry release\n6. Notify Slack\n</code></pre>"},{"location":"ARCHITECTURE/#best-practices-summary","title":"Best Practices Summary","text":""},{"location":"ARCHITECTURE/#do","title":"Do","text":"<ul> <li>Use type hints everywhere</li> <li>Keep endpoints thin (delegate to services)</li> <li>Use dependency injection</li> <li>Write async code for all I/O</li> <li>Add docstrings to public functions</li> <li>Follow naming conventions</li> <li>Write tests for new features</li> </ul>"},{"location":"ARCHITECTURE/#dont","title":"Don't","text":"<ul> <li>Put business logic in endpoints</li> <li>Use synchronous database calls</li> <li>Hardcode configuration values</li> <li>Commit secrets to git</li> <li>Skip input validation</li> <li>Ignore error handling</li> <li>Create god classes/functions</li> </ul>"},{"location":"CONTRIBUTING/","title":"Contributing Guide","text":"<p>Thank you for your interest in contributing to OmniStack Backend! This guide will help you get started.</p>"},{"location":"CONTRIBUTING/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Code of Conduct</li> <li>Getting Started</li> <li>Development Setup</li> <li>Making Changes</li> <li>Code Style</li> <li>Testing</li> <li>Pull Request Process</li> <li>Issue Guidelines</li> </ol>"},{"location":"CONTRIBUTING/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful, inclusive, and constructive. We're all here to learn and build great software together.</p>"},{"location":"CONTRIBUTING/#getting-started","title":"Getting Started","text":""},{"location":"CONTRIBUTING/#types-of-contributions","title":"Types of Contributions","text":"Type Description Label Bug Fix Fix a reported bug <code>bug</code> Feature Add new functionality <code>enhancement</code> Documentation Improve docs <code>documentation</code> Refactor Code improvement without changing behavior <code>refactor</code> Test Add or improve tests <code>testing</code>"},{"location":"CONTRIBUTING/#first-time-contributors","title":"First-Time Contributors","text":"<p>Look for issues labeled <code>good first issue</code> - these are specifically designed for newcomers.</p>"},{"location":"CONTRIBUTING/#development-setup","title":"Development Setup","text":""},{"location":"CONTRIBUTING/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.12+</li> <li>Docker &amp; Docker Compose</li> <li>Git</li> </ul>"},{"location":"CONTRIBUTING/#setup-steps","title":"Setup Steps","text":"<pre><code># 1. Fork the repository on GitHub\n\n# 2. Clone your fork\ngit clone https://github.com/YOUR_USERNAME/backend-boilerplate-fastapi.git\ncd backend-boilerplate-fastapi\n\n# 3. Add upstream remote\ngit remote add upstream https://github.com/omnistack/backend-boilerplate-fastapi.git\n\n# 4. Create virtual environment\nmake venv\nsource .venv/bin/activate\n\n# 5. Install all dependencies (including dev)\npip install -e \".[all]\"\n\n# 6. Copy environment file\ncp .env.example .env\n\n# 7. Start services\nmake up\n\n# 8. Run tests to verify setup\nmake test\nmake lint\n</code></pre>"},{"location":"CONTRIBUTING/#keep-your-fork-updated","title":"Keep Your Fork Updated","text":"<pre><code>git fetch upstream\ngit checkout main\ngit merge upstream/main\n</code></pre>"},{"location":"CONTRIBUTING/#making-changes","title":"Making Changes","text":""},{"location":"CONTRIBUTING/#branch-naming","title":"Branch Naming","text":"Type Pattern Example Feature <code>feature/description</code> <code>feature/add-webhook-retry</code> Bug fix <code>fix/description</code> <code>fix/rate-limit-header</code> Docs <code>docs/description</code> <code>docs/update-api-reference</code> Refactor <code>refactor/description</code> <code>refactor/simplify-crud-base</code>"},{"location":"CONTRIBUTING/#workflow","title":"Workflow","text":"<pre><code># 1. Create a new branch\ngit checkout -b feature/my-feature\n\n# 2. Make your changes\n# ... edit files ...\n\n# 3. Run tests\nmake test\n\n# 4. Run linter\nmake lint\n\n# 5. Commit your changes\ngit add .\ngit commit -m \"feat: add webhook retry mechanism\"\n\n# 6. Push to your fork\ngit push origin feature/my-feature\n\n# 7. Open a Pull Request on GitHub\n</code></pre>"},{"location":"CONTRIBUTING/#code-style","title":"Code Style","text":""},{"location":"CONTRIBUTING/#python-style","title":"Python Style","text":"<p>We use Ruff for linting and formatting.</p> <pre><code># Check for issues\nmake lint\n\n# Or run directly\nruff check app/ tests/\nruff format app/ tests/ --check\n</code></pre>"},{"location":"CONTRIBUTING/#style-rules","title":"Style Rules","text":"Rule Description Line length 100 characters max Quotes Double quotes <code>\"</code> Imports Sorted by <code>isort</code> (via Ruff) Type hints Required for all public functions Docstrings Required for public classes and functions"},{"location":"CONTRIBUTING/#examples","title":"Examples","text":"<p>Good: <pre><code>async def get_user_by_email(\n    session: AsyncSession,\n    email: str,\n) -&gt; User | None:\n    \"\"\"\n    Get a user by their email address.\n\n    Args:\n        session: Database session.\n        email: Email to search for.\n\n    Returns:\n        User if found, None otherwise.\n    \"\"\"\n    result = await session.execute(\n        select(User).where(User.email == email)\n    )\n    return result.scalar_one_or_none()\n</code></pre></p> <p>Bad: <pre><code>async def get_user_by_email(session, email):  # Missing type hints\n    result = await session.execute(select(User).where(User.email == email))\n    return result.scalar_one_or_none()\n</code></pre></p>"},{"location":"CONTRIBUTING/#naming-conventions","title":"Naming Conventions","text":"Type Convention Example Files snake_case <code>user_service.py</code> Classes PascalCase <code>UserService</code> Functions snake_case <code>get_user_by_id</code> Constants UPPER_SNAKE <code>MAX_RETRIES</code> Variables snake_case <code>user_count</code>"},{"location":"CONTRIBUTING/#import-order","title":"Import Order","text":"<pre><code># 1. Standard library\nimport json\nfrom datetime import datetime\n\n# 2. Third-party\nfrom fastapi import APIRouter, HTTPException\nfrom sqlmodel import select\n\n# 3. Local imports\nfrom app.core.config import settings\nfrom app.models.user import User\n</code></pre>"},{"location":"CONTRIBUTING/#testing","title":"Testing","text":""},{"location":"CONTRIBUTING/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\nmake test\n\n# Run with coverage\npytest tests/ --cov=app --cov-report=html\n\n# Run specific file\npytest tests/unit/test_user_service.py -v\n\n# Run specific test\npytest tests/unit/test_user_service.py::test_get_user -v\n\n# Run only unit tests\npytest tests/unit/ -v\n\n# Run only integration tests\npytest tests/integration/ -v\n</code></pre>"},{"location":"CONTRIBUTING/#test-structure","title":"Test Structure","text":"<pre><code>tests/\n\u251c\u2500\u2500 conftest.py           # Shared fixtures\n\u251c\u2500\u2500 unit/                 # Unit tests (no external deps)\n\u2502   \u251c\u2500\u2500 test_health.py\n\u2502   \u251c\u2500\u2500 test_user_service.py\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 integration/          # Integration tests (with DB)\n\u2502   \u251c\u2500\u2500 test_api_health.py\n\u2502   \u251c\u2500\u2500 test_api_users.py\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 load/                 # Load tests (Locust)\n    \u2514\u2500\u2500 locustfile.py\n</code></pre>"},{"location":"CONTRIBUTING/#writing-tests","title":"Writing Tests","text":"<p>Unit Test Example:</p> <pre><code># tests/unit/test_project_service.py\n\nimport pytest\nfrom unittest.mock import AsyncMock, MagicMock\n\nfrom app.business.project_service import project_service\nfrom app.models.project import Project\nfrom app.schemas.project import ProjectCreate\n\n\n@pytest.fixture\ndef mock_session():\n    \"\"\"Create a mock database session.\"\"\"\n    session = AsyncMock()\n    return session\n\n\n@pytest.fixture\ndef sample_project():\n    \"\"\"Create a sample project.\"\"\"\n    return Project(\n        id=\"test-id\",\n        name=\"Test Project\",\n        description=\"A test project\",\n        owner_id=\"user-123\",\n    )\n\n\nclass TestProjectService:\n    async def test_create_with_owner(self, mock_session):\n        \"\"\"Test creating a project with owner.\"\"\"\n        # Arrange\n        create_data = ProjectCreate(name=\"New Project\", description=\"Description\")\n        mock_session.flush = AsyncMock()\n        mock_session.refresh = AsyncMock()\n\n        # Act\n        result = await project_service.create_with_owner(\n            mock_session,\n            obj_in=create_data,\n            owner_id=\"user-123\",\n        )\n\n        # Assert\n        assert result.name == \"New Project\"\n        assert result.owner_id == \"user-123\"\n        mock_session.add.assert_called_once()\n\n\n    async def test_get_not_found(self, mock_session):\n        \"\"\"Test getting a non-existent project.\"\"\"\n        # Arrange\n        mock_result = MagicMock()\n        mock_result.scalar_one_or_none.return_value = None\n        mock_session.execute.return_value = mock_result\n\n        # Act\n        result = await project_service.get(mock_session, id=\"non-existent\")\n\n        # Assert\n        assert result is None\n</code></pre> <p>Integration Test Example:</p> <pre><code># tests/integration/test_api_projects.py\n\nimport pytest\nfrom httpx import AsyncClient\n\n\n@pytest.fixture\nasync def auth_headers(client: AsyncClient) -&gt; dict:\n    \"\"\"Get authentication headers with a valid token.\"\"\"\n    # Create test token\n    return {\"Authorization\": \"Bearer test-token\"}\n\n\nclass TestProjectsAPI:\n    async def test_create_project(self, client: AsyncClient, auth_headers: dict):\n        \"\"\"Test creating a new project.\"\"\"\n        response = await client.post(\n            \"/api/v1/app/projects\",\n            json={\"name\": \"Test Project\", \"description\": \"A test\"},\n            headers=auth_headers,\n        )\n\n        assert response.status_code == 201\n        data = response.json()\n        assert data[\"name\"] == \"Test Project\"\n        assert \"id\" in data\n\n\n    async def test_list_projects_pagination(\n        self, client: AsyncClient, auth_headers: dict\n    ):\n        \"\"\"Test listing projects with pagination.\"\"\"\n        # Create multiple projects first\n        for i in range(25):\n            await client.post(\n                \"/api/v1/app/projects\",\n                json={\"name\": f\"Project {i}\"},\n                headers=auth_headers,\n            )\n\n        # Test first page\n        response = await client.get(\n            \"/api/v1/app/projects\",\n            params={\"skip\": 0, \"limit\": 10},\n            headers=auth_headers,\n        )\n\n        assert response.status_code == 200\n        data = response.json()\n        assert len(data[\"items\"]) == 10\n        assert data[\"total\"] &gt;= 25\n        assert data[\"skip\"] == 0\n        assert data[\"limit\"] == 10\n\n\n    async def test_create_project_unauthenticated(self, client: AsyncClient):\n        \"\"\"Test that unauthenticated requests are rejected.\"\"\"\n        response = await client.post(\n            \"/api/v1/app/projects\",\n            json={\"name\": \"Test\"},\n        )\n\n        assert response.status_code == 401\n</code></pre>"},{"location":"CONTRIBUTING/#test-coverage","title":"Test Coverage","text":"<p>Aim for at least 80% code coverage. Check coverage:</p> <pre><code>pytest tests/ --cov=app --cov-report=term-missing\n</code></pre>"},{"location":"CONTRIBUTING/#pull-request-process","title":"Pull Request Process","text":""},{"location":"CONTRIBUTING/#before-submitting","title":"Before Submitting","text":"<ul> <li> Tests pass locally (<code>make test</code>)</li> <li> Linter passes (<code>make lint</code>)</li> <li> Code follows style guidelines</li> <li> Documentation updated (if needed)</li> <li> Commit messages follow convention</li> <li> Branch is up to date with main</li> </ul>"},{"location":"CONTRIBUTING/#commit-messages","title":"Commit Messages","text":"<p>Follow Conventional Commits:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre> <p>Types:</p> Type Description <code>feat</code> New feature <code>fix</code> Bug fix <code>docs</code> Documentation only <code>style</code> Formatting, no code change <code>refactor</code> Code change that neither fixes a bug nor adds a feature <code>test</code> Adding or updating tests <code>chore</code> Maintenance tasks <p>Examples:</p> <pre><code>feat(auth): add support for Clerk authentication\n\nfix(billing): correct invoice amount calculation\n\ndocs(api): update billing endpoint documentation\n\nrefactor(crud): simplify generic CRUD base class\n\ntest(projects): add integration tests for project search\n</code></pre>"},{"location":"CONTRIBUTING/#pr-description-template","title":"PR Description Template","text":"<pre><code>## Summary\nBrief description of changes.\n\n## Changes\n- Added X\n- Fixed Y\n- Updated Z\n\n## Testing\n- [ ] Unit tests added/updated\n- [ ] Integration tests added/updated\n- [ ] Manually tested\n\n## Related Issues\nFixes #123\n</code></pre>"},{"location":"CONTRIBUTING/#review-process","title":"Review Process","text":"<ol> <li>Automated checks run (tests, lint)</li> <li>Code review by maintainer</li> <li>Address feedback if requested</li> <li>Approval and merge</li> </ol>"},{"location":"CONTRIBUTING/#issue-guidelines","title":"Issue Guidelines","text":""},{"location":"CONTRIBUTING/#bug-reports","title":"Bug Reports","text":"<p>Use the bug report template:</p> <pre><code>**Description**\nClear description of the bug.\n\n**Steps to Reproduce**\n1. Step 1\n2. Step 2\n3. Step 3\n\n**Expected Behavior**\nWhat should happen.\n\n**Actual Behavior**\nWhat actually happens.\n\n**Environment**\n- OS: [e.g., macOS 14.0]\n- Python: [e.g., 3.12.0]\n- Package version: [e.g., 0.1.0]\n\n**Additional Context**\nAny other relevant information.\n</code></pre>"},{"location":"CONTRIBUTING/#feature-requests","title":"Feature Requests","text":"<p>Use the feature request template:</p> <pre><code>**Problem**\nWhat problem does this solve?\n\n**Proposed Solution**\nHow should it work?\n\n**Alternatives Considered**\nOther approaches you've thought of.\n\n**Additional Context**\nAny other relevant information.\n</code></pre>"},{"location":"CONTRIBUTING/#development-tips","title":"Development Tips","text":""},{"location":"CONTRIBUTING/#debugging","title":"Debugging","text":"<pre><code># Use Python debugger\nimport pdb; pdb.set_trace()\n\n# Or better, use ipdb\nimport ipdb; ipdb.set_trace()\n\n# Print SQL queries\n# Add to .env: SQLALCHEMY_ECHO=true\n</code></pre>"},{"location":"CONTRIBUTING/#database-migrations","title":"Database Migrations","text":"<pre><code># Create a new migration\nmake migrate msg=\"add new field to users\"\n\n# Or manually\nalembic revision --autogenerate -m \"description\"\nalembic upgrade head\n\n# Rollback last migration\nalembic downgrade -1\n\n# View migration history\nalembic history\n</code></pre>"},{"location":"CONTRIBUTING/#local-testing-with-different-configs","title":"Local Testing with Different Configs","text":"<pre><code># Test with different auth provider\nAUTH_PROVIDER=clerk make test\n\n# Test without Redis\nREDIS_URL= make test\n</code></pre>"},{"location":"CONTRIBUTING/#vs-code-settings","title":"VS Code Settings","text":"<p>Recommended <code>.vscode/settings.json</code>:</p> <pre><code>{\n  \"python.defaultInterpreterPath\": \"${workspaceFolder}/.venv/bin/python\",\n  \"python.formatting.provider\": \"none\",\n  \"[python]\": {\n    \"editor.defaultFormatter\": \"charliermarsh.ruff\",\n    \"editor.formatOnSave\": true,\n    \"editor.codeActionsOnSave\": {\n      \"source.fixAll\": \"explicit\",\n      \"source.organizeImports\": \"explicit\"\n    }\n  },\n  \"python.testing.pytestEnabled\": true,\n  \"python.testing.pytestArgs\": [\"tests\"]\n}\n</code></pre>"},{"location":"CONTRIBUTING/#questions","title":"Questions?","text":"<ul> <li>Open a GitHub Discussion</li> <li>Check existing issues and PRs</li> <li>Read the documentation</li> </ul> <p>Thank you for contributing!</p>"},{"location":"FRONTEND-INTEGRATION/","title":"Frontend Integration Guide","text":"<p>Everything frontend and mobile developers need to integrate with the OmniStack Backend API.</p>"},{"location":"FRONTEND-INTEGRATION/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Quick Start</li> <li>Authentication</li> <li>TypeScript Types</li> <li>API Client Setup</li> <li>Common Patterns</li> <li>Error Handling</li> <li>Real-time &amp; Streaming</li> <li>Next.js (App Router)</li> <li>React Examples</li> <li>Mobile (React Native)</li> <li>Native iOS (Swift)</li> <li>Native Android (Kotlin)</li> </ol>"},{"location":"FRONTEND-INTEGRATION/#quick-start","title":"Quick Start","text":""},{"location":"FRONTEND-INTEGRATION/#base-url","title":"Base URL","text":"<pre><code>const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1';\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#basic-request","title":"Basic Request","text":"<pre><code>// Simple GET request\nconst response = await fetch(`${API_BASE_URL}/app/users/me`, {\n  headers: {\n    'Authorization': `Bearer ${accessToken}`,\n  },\n});\nconst user = await response.json();\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#authentication","title":"Authentication","text":""},{"location":"FRONTEND-INTEGRATION/#with-supabase","title":"With Supabase","text":"<pre><code>import { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\n// Get access token for API calls\nasync function getAccessToken(): Promise&lt;string | null&gt; {\n  const { data: { session } } = await supabase.auth.getSession();\n  return session?.access_token ?? null;\n}\n\n// Make authenticated request\nasync function fetchAPI&lt;T&gt;(endpoint: string, options: RequestInit = {}): Promise&lt;T&gt; {\n  const token = await getAccessToken();\n\n  const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n    ...options,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token &amp;&amp; { 'Authorization': `Bearer ${token}` }),\n      ...options.headers,\n    },\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new APIError(error);\n  }\n\n  return response.json();\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#with-clerk","title":"With Clerk","text":"<pre><code>import { useAuth } from '@clerk/nextjs';\n\nfunction MyComponent() {\n  const { getToken } = useAuth();\n\n  async function fetchData() {\n    const token = await getToken();\n\n    const response = await fetch(`${API_BASE_URL}/app/users/me`, {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    });\n\n    return response.json();\n  }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#token-refresh-pattern","title":"Token Refresh Pattern","text":"<pre><code>// The auth provider (Supabase/Clerk) handles token refresh automatically\n// Just always call getSession()/getToken() before each request\n\nasync function makeRequest(endpoint: string) {\n  // This always returns a fresh/valid token\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (!session) {\n    // Redirect to login\n    throw new Error('Not authenticated');\n  }\n\n  return fetch(`${API_BASE_URL}${endpoint}`, {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#typescript-types","title":"TypeScript Types","text":""},{"location":"FRONTEND-INTEGRATION/#core-types","title":"Core Types","text":"<pre><code>// ============================================\n// Common Types\n// ============================================\n\ninterface PaginatedResponse&lt;T&gt; {\n  items: T[];\n  total: number;\n  skip: number;\n  limit: number;\n}\n\ninterface ErrorResponse {\n  error: {\n    code: string;\n    message: string;\n    details: Record&lt;string, unknown&gt;;\n  };\n}\n\n// Pagination helper\ninterface PaginationInfo {\n  total: number;\n  skip: number;\n  limit: number;\n  currentPage: number;\n  totalPages: number;\n  hasNext: boolean;\n  hasPrev: boolean;\n}\n\nfunction getPaginationInfo(response: PaginatedResponse&lt;unknown&gt;): PaginationInfo {\n  const totalPages = Math.ceil(response.total / response.limit);\n  const currentPage = Math.floor(response.skip / response.limit) + 1;\n\n  return {\n    total: response.total,\n    skip: response.skip,\n    limit: response.limit,\n    currentPage,\n    totalPages,\n    hasNext: response.skip + response.items.length &lt; response.total,\n    hasPrev: response.skip &gt; 0,\n  };\n}\n\n// ============================================\n// User Types\n// ============================================\n\ninterface User {\n  id: string;\n  email: string;\n  full_name: string | null;\n  avatar_url: string | null;\n  role: 'user' | 'admin' | 'superadmin';\n  is_active: boolean;\n  subscription_plan: 'free' | 'pro' | 'enterprise' | null;\n  subscription_status: 'active' | 'canceled' | 'past_due' | 'trialing' | 'incomplete' | null;\n  created_at: string; // ISO 8601\n}\n\ninterface UserUpdate {\n  full_name?: string;\n  avatar_url?: string;\n}\n\n// ============================================\n// Project Types\n// ============================================\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string | null;\n  owner_id: string;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface ProjectCreate {\n  name: string;\n  description?: string;\n}\n\ninterface ProjectUpdate {\n  name?: string;\n  description?: string;\n}\n\ntype ProjectListResponse = PaginatedResponse&lt;Project&gt;;\n\n// ============================================\n// File Types\n// ============================================\n\ninterface FileUploadRequest {\n  filename: string;\n  content_type: string;\n  size: number;\n}\n\ninterface PresignedUploadResponse {\n  upload_url: string;\n  file_id: string;\n  key: string;\n  expires_in: number;\n}\n\ninterface FileRecord {\n  id: string;\n  filename: string;\n  content_type: string;\n  size: number;\n  status: 'pending' | 'uploaded' | 'failed';\n  created_at: string;\n}\n\ninterface DownloadUrlResponse {\n  download_url: string;\n  expires_in: number;\n}\n\n// ============================================\n// AI Types\n// ============================================\n\ntype MessageRole = 'system' | 'user' | 'assistant';\n\ninterface ChatMessage {\n  role: MessageRole;\n  content: string;\n}\n\ninterface CompletionRequest {\n  messages: ChatMessage[];\n  model?: string;\n  temperature?: number;\n  max_tokens?: number;\n  stream?: boolean;\n}\n\ninterface SimpleCompletionRequest {\n  prompt: string;\n  system?: string;\n  model?: string;\n  temperature?: number;\n  max_tokens?: number;\n  stream?: boolean;\n}\n\ninterface RoutedCompletionRequest {\n  prompt: string;\n  system?: string;\n  complexity: 'simple' | 'moderate' | 'complex' | 'search';\n  temperature?: number;\n  max_tokens?: number;\n}\n\ninterface TokenUsage {\n  prompt_tokens: number;\n  completion_tokens: number;\n  total_tokens: number;\n}\n\ninterface CompletionResponse {\n  content: string;\n  model: string;\n  provider: string;\n  usage: TokenUsage;\n  finish_reason: string;\n  latency_ms: number;\n}\n\ninterface AIStatusResponse {\n  available: boolean;\n  providers: string[];\n  default_provider: string;\n  default_model: string;\n}\n\n// ============================================\n// Billing Types\n// ============================================\n\ninterface BillingStatus {\n  plan: string;\n  status: string | null;\n  current_period_end: string | null;\n  cancel_at_period_end: boolean;\n  has_active_subscription: boolean;\n}\n\ninterface CheckoutRequest {\n  plan: 'monthly' | 'yearly';\n  success_url: string;\n  cancel_url: string;\n}\n\ninterface CheckoutResponse {\n  session_id: string;\n  url: string;\n}\n\ninterface PortalResponse {\n  url: string;\n}\n\ninterface Invoice {\n  id: string;\n  number: string | null;\n  status: string;\n  amount_due: number;\n  amount_paid: number;\n  currency: string;\n  created: number;\n  hosted_invoice_url: string | null;\n  invoice_pdf: string | null;\n}\n\n// ============================================\n// Health Types\n// ============================================\n\ninterface HealthResponse {\n  status: string;\n  timestamp: string;\n}\n\ninterface HealthReadyResponse {\n  status: string;\n  timestamp: string;\n  components: {\n    database: { status: string };\n    cache: { status: string };\n  };\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#error-types","title":"Error Types","text":"<pre><code>// API Error codes\ntype ErrorCode =\n  | 'BAD_REQUEST'\n  | 'AUTHENTICATION_ERROR'\n  | 'AUTHORIZATION_ERROR'\n  | 'NOT_FOUND'\n  | 'CONFLICT'\n  | 'VALIDATION_ERROR'\n  | 'RATE_LIMIT_EXCEEDED'\n  | 'EXTERNAL_SERVICE_ERROR'\n  | 'SERVICE_UNAVAILABLE';\n\nclass APIError extends Error {\n  code: ErrorCode;\n  details: Record&lt;string, unknown&gt;;\n  status: number;\n\n  constructor(response: ErrorResponse, status: number = 400) {\n    super(response.error.message);\n    this.code = response.error.code as ErrorCode;\n    this.details = response.error.details;\n    this.status = status;\n    this.name = 'APIError';\n  }\n\n  // Helper methods\n  isNotFound(): boolean {\n    return this.code === 'NOT_FOUND';\n  }\n\n  isAuthError(): boolean {\n    return this.code === 'AUTHENTICATION_ERROR' || this.code === 'AUTHORIZATION_ERROR';\n  }\n\n  isRateLimited(): boolean {\n    return this.code === 'RATE_LIMIT_EXCEEDED';\n  }\n\n  isValidationError(): boolean {\n    return this.code === 'VALIDATION_ERROR';\n  }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#api-client-setup","title":"API Client Setup","text":""},{"location":"FRONTEND-INTEGRATION/#basic-fetch-wrapper","title":"Basic Fetch Wrapper","text":"<pre><code>// lib/api.ts\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL!;\n\ninterface RequestOptions extends RequestInit {\n  params?: Record&lt;string, string | number&gt;;\n}\n\nasync function getAuthToken(): Promise&lt;string | null&gt; {\n  // Implement based on your auth provider\n  const { data: { session } } = await supabase.auth.getSession();\n  return session?.access_token ?? null;\n}\n\nexport async function api&lt;T&gt;(\n  endpoint: string,\n  options: RequestOptions = {}\n): Promise&lt;T&gt; {\n  const { params, ...fetchOptions } = options;\n\n  // Build URL with query params\n  let url = `${API_BASE_URL}${endpoint}`;\n  if (params) {\n    const searchParams = new URLSearchParams();\n    Object.entries(params).forEach(([key, value]) =&gt; {\n      searchParams.append(key, String(value));\n    });\n    url += `?${searchParams.toString()}`;\n  }\n\n  // Get auth token\n  const token = await getAuthToken();\n\n  // Make request\n  const response = await fetch(url, {\n    ...fetchOptions,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token &amp;&amp; { 'Authorization': `Bearer ${token}` }),\n      ...fetchOptions.headers,\n    },\n  });\n\n  // Handle errors\n  if (!response.ok) {\n    const errorData = await response.json();\n    throw new APIError(errorData, response.status);\n  }\n\n  // Handle 204 No Content\n  if (response.status === 204) {\n    return undefined as T;\n  }\n\n  return response.json();\n}\n\n// Convenience methods\nexport const apiClient = {\n  get: &lt;T&gt;(endpoint: string, params?: Record&lt;string, string | number&gt;) =&gt;\n    api&lt;T&gt;(endpoint, { method: 'GET', params }),\n\n  post: &lt;T&gt;(endpoint: string, data?: unknown) =&gt;\n    api&lt;T&gt;(endpoint, { method: 'POST', body: JSON.stringify(data) }),\n\n  patch: &lt;T&gt;(endpoint: string, data?: unknown) =&gt;\n    api&lt;T&gt;(endpoint, { method: 'PATCH', body: JSON.stringify(data) }),\n\n  delete: &lt;T&gt;(endpoint: string) =&gt;\n    api&lt;T&gt;(endpoint, { method: 'DELETE' }),\n};\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#axios-client","title":"Axios Client","text":"<pre><code>// lib/axios.ts\n\nimport axios, { AxiosError } from 'axios';\n\nconst apiClient = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Request interceptor - add auth token\napiClient.interceptors.request.use(async (config) =&gt; {\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (session?.access_token) {\n    config.headers.Authorization = `Bearer ${session.access_token}`;\n  }\n\n  return config;\n});\n\n// Response interceptor - handle errors\napiClient.interceptors.response.use(\n  (response) =&gt; response,\n  (error: AxiosError&lt;ErrorResponse&gt;) =&gt; {\n    if (error.response) {\n      throw new APIError(error.response.data, error.response.status);\n    }\n    throw error;\n  }\n);\n\nexport { apiClient };\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#tanstack-query-setup","title":"TanStack Query Setup","text":"<pre><code>// lib/query.ts\n\nimport { QueryClient } from '@tanstack/react-query';\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 5 * 60 * 1000, // 5 minutes\n      retry: (failureCount, error) =&gt; {\n        // Don't retry on auth errors\n        if (error instanceof APIError &amp;&amp; error.isAuthError()) {\n          return false;\n        }\n        return failureCount &lt; 3;\n      },\n    },\n  },\n});\n\n// Query keys factory\nexport const queryKeys = {\n  user: {\n    current: ['user', 'current'] as const,\n  },\n  projects: {\n    all: ['projects'] as const,\n    list: (params: { skip?: number; limit?: number; search?: string }) =&gt;\n      ['projects', 'list', params] as const,\n    detail: (id: string) =&gt; ['projects', 'detail', id] as const,\n  },\n  billing: {\n    status: ['billing', 'status'] as const,\n    invoices: ['billing', 'invoices'] as const,\n  },\n  ai: {\n    status: ['ai', 'status'] as const,\n  },\n};\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#common-patterns","title":"Common Patterns","text":""},{"location":"FRONTEND-INTEGRATION/#pagination","title":"Pagination","text":"<pre><code>// hooks/usePaginatedProjects.ts\n\nimport { useQuery } from '@tanstack/react-query';\nimport { useState } from 'react';\n\ninterface UsePaginatedProjectsOptions {\n  initialLimit?: number;\n  search?: string;\n}\n\nexport function usePaginatedProjects(options: UsePaginatedProjectsOptions = {}) {\n  const { initialLimit = 20, search } = options;\n  const [page, setPage] = useState(0);\n\n  const query = useQuery({\n    queryKey: queryKeys.projects.list({\n      skip: page * initialLimit,\n      limit: initialLimit,\n      search,\n    }),\n    queryFn: () =&gt;\n      apiClient.get&lt;ProjectListResponse&gt;('/app/projects', {\n        skip: page * initialLimit,\n        limit: initialLimit,\n        ...(search &amp;&amp; { search }),\n      }),\n  });\n\n  const pagination = query.data ? getPaginationInfo(query.data) : null;\n\n  return {\n    ...query,\n    pagination,\n    page,\n    setPage,\n    nextPage: () =&gt; setPage((p) =&gt; p + 1),\n    prevPage: () =&gt; setPage((p) =&gt; Math.max(0, p - 1)),\n  };\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#optimistic-updates","title":"Optimistic Updates","text":"<pre><code>// hooks/useUpdateProject.ts\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\n\nexport function useUpdateProject(projectId: string) {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: (data: ProjectUpdate) =&gt;\n      apiClient.patch&lt;Project&gt;(`/app/projects/${projectId}`, data),\n\n    // Optimistic update\n    onMutate: async (newData) =&gt; {\n      // Cancel outgoing refetches\n      await queryClient.cancelQueries({\n        queryKey: queryKeys.projects.detail(projectId),\n      });\n\n      // Snapshot previous value\n      const previousProject = queryClient.getQueryData&lt;Project&gt;(\n        queryKeys.projects.detail(projectId)\n      );\n\n      // Optimistically update\n      if (previousProject) {\n        queryClient.setQueryData(\n          queryKeys.projects.detail(projectId),\n          { ...previousProject, ...newData }\n        );\n      }\n\n      return { previousProject };\n    },\n\n    // Rollback on error\n    onError: (err, newData, context) =&gt; {\n      if (context?.previousProject) {\n        queryClient.setQueryData(\n          queryKeys.projects.detail(projectId),\n          context.previousProject\n        );\n      }\n    },\n\n    // Refetch after success or error\n    onSettled: () =&gt; {\n      queryClient.invalidateQueries({\n        queryKey: queryKeys.projects.detail(projectId),\n      });\n    },\n  });\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#file-upload","title":"File Upload","text":"<pre><code>// hooks/useFileUpload.ts\n\ninterface UseFileUploadOptions {\n  onProgress?: (progress: number) =&gt; void;\n  onSuccess?: (file: FileRecord) =&gt; void;\n  onError?: (error: Error) =&gt; void;\n}\n\nexport function useFileUpload(options: UseFileUploadOptions = {}) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n\n  const upload = async (file: File) =&gt; {\n    setIsUploading(true);\n    setProgress(0);\n\n    try {\n      // 1. Get presigned upload URL\n      const presigned = await apiClient.post&lt;PresignedUploadResponse&gt;(\n        '/app/files/upload-url',\n        {\n          filename: file.name,\n          content_type: file.type,\n          size: file.size,\n        }\n      );\n\n      // 2. Upload to storage (with progress tracking)\n      await new Promise&lt;void&gt;((resolve, reject) =&gt; {\n        const xhr = new XMLHttpRequest();\n\n        xhr.upload.addEventListener('progress', (e) =&gt; {\n          if (e.lengthComputable) {\n            const pct = Math.round((e.loaded / e.total) * 100);\n            setProgress(pct);\n            options.onProgress?.(pct);\n          }\n        });\n\n        xhr.addEventListener('load', () =&gt; {\n          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {\n            resolve();\n          } else {\n            reject(new Error('Upload failed'));\n          }\n        });\n\n        xhr.addEventListener('error', () =&gt; reject(new Error('Upload failed')));\n\n        xhr.open('PUT', presigned.upload_url);\n        xhr.setRequestHeader('Content-Type', file.type);\n        xhr.send(file);\n      });\n\n      // 3. Confirm upload\n      const fileRecord = await apiClient.post&lt;FileRecord&gt;(\n        '/app/files/confirm',\n        { file_id: presigned.file_id }\n      );\n\n      options.onSuccess?.(fileRecord);\n      return fileRecord;\n\n    } catch (error) {\n      options.onError?.(error as Error);\n      throw error;\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  return {\n    upload,\n    isUploading,\n    progress,\n  };\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#error-handling","title":"Error Handling","text":""},{"location":"FRONTEND-INTEGRATION/#global-error-handler","title":"Global Error Handler","text":"<pre><code>// components/ErrorBoundary.tsx\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport function useAPIErrorHandler() {\n  const router = useRouter();\n\n  const handleError = (error: unknown) =&gt; {\n    if (error instanceof APIError) {\n      switch (error.code) {\n        case 'AUTHENTICATION_ERROR':\n          // Redirect to login\n          router.push('/login');\n          break;\n\n        case 'AUTHORIZATION_ERROR':\n          // Show forbidden page\n          router.push('/403');\n          break;\n\n        case 'NOT_FOUND':\n          // Show 404\n          router.push('/404');\n          break;\n\n        case 'RATE_LIMIT_EXCEEDED':\n          // Show rate limit message\n          const retryAfter = error.details.retry_after as number;\n          toast.error(`Too many requests. Try again in ${retryAfter} seconds.`);\n          break;\n\n        case 'VALIDATION_ERROR':\n          // Show field-specific error\n          const field = error.details.field as string;\n          toast.error(`${field}: ${error.message}`);\n          break;\n\n        default:\n          toast.error(error.message);\n      }\n    } else {\n      toast.error('An unexpected error occurred');\n      console.error(error);\n    }\n  };\n\n  return handleError;\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#form-validation-errors","title":"Form Validation Errors","text":"<pre><code>// hooks/useFormWithAPI.ts\n\ninterface UseFormWithAPIOptions&lt;T&gt; {\n  onSubmit: (data: T) =&gt; Promise&lt;void&gt;;\n}\n\nexport function useFormWithAPI&lt;T extends Record&lt;string, unknown&gt;&gt;(\n  options: UseFormWithAPIOptions&lt;T&gt;\n) {\n  const [errors, setErrors] = useState&lt;Record&lt;string, string&gt;&gt;({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (data: T) =&gt; {\n    setErrors({});\n    setIsSubmitting(true);\n\n    try {\n      await options.onSubmit(data);\n    } catch (error) {\n      if (error instanceof APIError &amp;&amp; error.isValidationError()) {\n        const field = error.details.field as string;\n        if (field) {\n          setErrors({ [field]: error.message });\n        }\n      } else {\n        throw error;\n      }\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return {\n    errors,\n    isSubmitting,\n    handleSubmit,\n    clearErrors: () =&gt; setErrors({}),\n  };\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#real-time-streaming","title":"Real-time &amp; Streaming","text":""},{"location":"FRONTEND-INTEGRATION/#ai-streaming-with-sse","title":"AI Streaming with SSE","text":"<pre><code>// hooks/useStreamingCompletion.ts\n\ninterface UseStreamingCompletionOptions {\n  onChunk?: (chunk: string) =&gt; void;\n  onComplete?: (fullText: string) =&gt; void;\n  onError?: (error: Error) =&gt; void;\n}\n\nexport function useStreamingCompletion(options: UseStreamingCompletionOptions = {}) {\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [content, setContent] = useState('');\n\n  const stream = async (request: SimpleCompletionRequest) =&gt; {\n    setIsStreaming(true);\n    setContent('');\n\n    try {\n      const token = await getAuthToken();\n\n      const response = await fetch(`${API_BASE_URL}/app/ai/chat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({ ...request, stream: true }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Stream request failed');\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n\n      let fullContent = '';\n\n      while (reader) {\n        const { done, value } = await reader.read();\n\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        const lines = chunk.split('\\n');\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n\n            if (data === '[DONE]') {\n              break;\n            }\n\n            fullContent += data;\n            setContent(fullContent);\n            options.onChunk?.(data);\n          }\n        }\n      }\n\n      options.onComplete?.(fullContent);\n      return fullContent;\n\n    } catch (error) {\n      options.onError?.(error as Error);\n      throw error;\n    } finally {\n      setIsStreaming(false);\n    }\n  };\n\n  return {\n    stream,\n    isStreaming,\n    content,\n    reset: () =&gt; setContent(''),\n  };\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#usage-in-component","title":"Usage in Component","text":"<pre><code>function ChatInterface() {\n  const { stream, isStreaming, content, reset } = useStreamingCompletion();\n  const [input, setInput] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) =&gt; {\n    e.preventDefault();\n    reset();\n\n    await stream({\n      prompt: input,\n      system: 'You are a helpful assistant.',\n    });\n\n    setInput('');\n  };\n\n  return (\n    &lt;div&gt;\n      &lt;div className=\"response\"&gt;\n        {content}\n        {isStreaming &amp;&amp; &lt;span className=\"cursor\"&gt;|&lt;/span&gt;}\n      &lt;/div&gt;\n\n      &lt;form onSubmit={handleSubmit}&gt;\n        &lt;input\n          value={input}\n          onChange={(e) =&gt; setInput(e.target.value)}\n          disabled={isStreaming}\n        /&gt;\n        &lt;button type=\"submit\" disabled={isStreaming}&gt;\n          Send\n        &lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#nextjs-app-router","title":"Next.js (App Router)","text":""},{"location":"FRONTEND-INTEGRATION/#project-setup","title":"Project Setup","text":"<pre><code># Create Next.js app\nnpx create-next-app@latest my-app --typescript --tailwind --app\n\n# Install dependencies\nnpm install @supabase/supabase-js @tanstack/react-query\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#environment-variables","title":"Environment Variables","text":"<pre><code># .env.local\nNEXT_PUBLIC_API_URL=http://localhost:8000/api/v1\nNEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co\nNEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#supabase-client-client-server","title":"Supabase Client (Client &amp; Server)","text":"<pre><code>// lib/supabase/client.ts\nimport { createBrowserClient } from '@supabase/ssr';\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  );\n}\n</code></pre> <pre><code>// lib/supabase/server.ts\nimport { createServerClient, type CookieOptions } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =&gt;\n              cookieStore.set(name, value, options)\n            );\n          } catch {\n            // Called from Server Component\n          }\n        },\n      },\n    }\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#api-client-for-server-components","title":"API Client for Server Components","text":"<pre><code>// lib/api/server.ts\nimport { createClient } from '@/lib/supabase/server';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL!;\n\nexport async function serverApi&lt;T&gt;(\n  endpoint: string,\n  options: RequestInit = {}\n): Promise&lt;T&gt; {\n  const supabase = await createClient();\n  const { data: { session } } = await supabase.auth.getSession();\n\n  const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n    ...options,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(session?.access_token &amp;&amp; {\n        'Authorization': `Bearer ${session.access_token}`,\n      }),\n      ...options.headers,\n    },\n    // Important for Next.js caching\n    cache: options.cache || 'no-store',\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error?.message || 'API request failed');\n  }\n\n  if (response.status === 204) {\n    return undefined as T;\n  }\n\n  return response.json();\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#server-component-example","title":"Server Component Example","text":"<pre><code>// app/dashboard/page.tsx\nimport { serverApi } from '@/lib/api/server';\nimport { redirect } from 'next/navigation';\nimport { createClient } from '@/lib/supabase/server';\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string | null;\n  created_at: string;\n}\n\ninterface ProjectsResponse {\n  items: Project[];\n  total: number;\n  skip: number;\n  limit: number;\n}\n\nexport default async function DashboardPage() {\n  const supabase = await createClient();\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (!session) {\n    redirect('/login');\n  }\n\n  // Fetch data on the server\n  const projects = await serverApi&lt;ProjectsResponse&gt;('/app/projects?limit=10');\n\n  return (\n    &lt;div&gt;\n      &lt;h1&gt;Dashboard&lt;/h1&gt;\n      &lt;p&gt;Welcome, {session.user.email}&lt;/p&gt;\n\n      &lt;h2&gt;Your Projects ({projects.total})&lt;/h2&gt;\n      &lt;ul&gt;\n        {projects.items.map((project) =&gt; (\n          &lt;li key={project.id}&gt;\n            &lt;h3&gt;{project.name}&lt;/h3&gt;\n            &lt;p&gt;{project.description}&lt;/p&gt;\n          &lt;/li&gt;\n        ))}\n      &lt;/ul&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#server-actions","title":"Server Actions","text":"<pre><code>// app/actions/projects.ts\n'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { serverApi } from '@/lib/api/server';\n\ninterface ProjectCreate {\n  name: string;\n  description?: string;\n}\n\nexport async function createProject(data: ProjectCreate) {\n  try {\n    const project = await serverApi('/app/projects', {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n\n    revalidatePath('/dashboard');\n    return { success: true, project };\n  } catch (error) {\n    return { success: false, error: (error as Error).message };\n  }\n}\n\nexport async function deleteProject(projectId: string) {\n  try {\n    await serverApi(`/app/projects/${projectId}`, {\n      method: 'DELETE',\n    });\n\n    revalidatePath('/dashboard');\n    return { success: true };\n  } catch (error) {\n    return { success: false, error: (error as Error).message };\n  }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#client-component-with-server-action","title":"Client Component with Server Action","text":"<pre><code>// components/CreateProjectForm.tsx\n'use client';\n\nimport { useFormStatus } from 'react-dom';\nimport { createProject } from '@/app/actions/projects';\nimport { useState } from 'react';\n\nfunction SubmitButton() {\n  const { pending } = useFormStatus();\n  return (\n    &lt;button type=\"submit\" disabled={pending}&gt;\n      {pending ? 'Creating...' : 'Create Project'}\n    &lt;/button&gt;\n  );\n}\n\nexport function CreateProjectForm() {\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  async function handleSubmit(formData: FormData) {\n    const result = await createProject({\n      name: formData.get('name') as string,\n      description: formData.get('description') as string || undefined,\n    });\n\n    if (!result.success) {\n      setError(result.error || 'Failed to create project');\n    }\n  }\n\n  return (\n    &lt;form action={handleSubmit}&gt;\n      {error &amp;&amp; &lt;p className=\"text-red-500\"&gt;{error}&lt;/p&gt;}\n\n      &lt;input\n        name=\"name\"\n        placeholder=\"Project name\"\n        required\n      /&gt;\n\n      &lt;textarea\n        name=\"description\"\n        placeholder=\"Description (optional)\"\n      /&gt;\n\n      &lt;SubmitButton /&gt;\n    &lt;/form&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#route-handler-api-route","title":"Route Handler (API Route)","text":"<pre><code>// app/api/user/route.ts\nimport { NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL!;\n\nexport async function GET() {\n  const supabase = await createClient();\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (!session) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n\n  const response = await fetch(`${API_BASE_URL}/app/users/me`, {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  const data = await response.json();\n  return NextResponse.json(data);\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#middleware-auth-protection","title":"Middleware (Auth Protection)","text":"<pre><code>// middleware.ts\nimport { createServerClient, type CookieOptions } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\nexport async function middleware(request: NextRequest) {\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) =&gt;\n            request.cookies.set(name, value)\n          );\n          response = NextResponse.next({\n            request: {\n              headers: request.headers,\n            },\n          });\n          cookiesToSet.forEach(({ name, value, options }) =&gt;\n            response.cookies.set(name, value, options)\n          );\n        },\n      },\n    }\n  );\n\n  const { data: { session } } = await supabase.auth.getSession();\n\n  // Protect routes\n  if (!session &amp;&amp; request.nextUrl.pathname.startsWith('/dashboard')) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  // Redirect logged-in users away from auth pages\n  if (session &amp;&amp; request.nextUrl.pathname.startsWith('/login')) {\n    return NextResponse.redirect(new URL('/dashboard', request.url));\n  }\n\n  return response;\n}\n\nexport const config = {\n  matcher: ['/dashboard/:path*', '/login', '/signup'],\n};\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#react-query-provider","title":"React Query Provider","text":"<pre><code>// app/providers.tsx\n'use client';\n\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useState } from 'react';\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =&gt; new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 60 * 1000, // 1 minute\n        refetchOnWindowFocus: false,\n      },\n    },\n  }));\n\n  return (\n    &lt;QueryClientProvider client={queryClient}&gt;\n      {children}\n    &lt;/QueryClientProvider&gt;\n  );\n}\n</code></pre> <pre><code>// app/layout.tsx\nimport { Providers } from './providers';\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    &lt;html lang=\"en\"&gt;\n      &lt;body&gt;\n        &lt;Providers&gt;{children}&lt;/Providers&gt;\n      &lt;/body&gt;\n    &lt;/html&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#streaming-ai-response-in-nextjs","title":"Streaming AI Response in Next.js","text":"<pre><code>// app/api/ai/chat/route.ts\nimport { createClient } from '@/lib/supabase/server';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL!;\n\nexport async function POST(request: Request) {\n  const supabase = await createClient();\n  const { data: { session } } = await supabase.auth.getSession();\n\n  if (!session) {\n    return new Response('Unauthorized', { status: 401 });\n  }\n\n  const body = await request.json();\n\n  const response = await fetch(`${API_BASE_URL}/app/ai/chat`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    body: JSON.stringify({ ...body, stream: true }),\n  });\n\n  // Forward the stream\n  return new Response(response.body, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n</code></pre> <pre><code>// components/AIChat.tsx\n'use client';\n\nimport { useState } from 'react';\n\nexport function AIChat() {\n  const [input, setInput] = useState('');\n  const [response, setResponse] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setIsLoading(true);\n    setResponse('');\n\n    const res = await fetch('/api/ai/chat', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ prompt: input }),\n    });\n\n    const reader = res.body?.getReader();\n    const decoder = new TextDecoder();\n\n    while (reader) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      const chunk = decoder.decode(value);\n      const lines = chunk.split('\\n');\n\n      for (const line of lines) {\n        if (line.startsWith('data: ') &amp;&amp; line !== 'data: [DONE]') {\n          setResponse((prev) =&gt; prev + line.slice(6));\n        }\n      }\n    }\n\n    setIsLoading(false);\n    setInput('');\n  }\n\n  return (\n    &lt;div&gt;\n      &lt;div className=\"response\"&gt;{response}&lt;/div&gt;\n      &lt;form onSubmit={handleSubmit}&gt;\n        &lt;input\n          value={input}\n          onChange={(e) =&gt; setInput(e.target.value)}\n          disabled={isLoading}\n          placeholder=\"Ask something...\"\n        /&gt;\n        &lt;button type=\"submit\" disabled={isLoading}&gt;\n          {isLoading ? 'Thinking...' : 'Send'}\n        &lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#react-examples","title":"React Examples","text":""},{"location":"FRONTEND-INTEGRATION/#user-profile-component","title":"User Profile Component","text":"<pre><code>// components/UserProfile.tsx\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\nexport function UserProfile() {\n  const queryClient = useQueryClient();\n\n  const { data: user, isLoading } = useQuery({\n    queryKey: queryKeys.user.current,\n    queryFn: () =&gt; apiClient.get&lt;User&gt;('/app/users/me'),\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (data: UserUpdate) =&gt;\n      apiClient.patch&lt;User&gt;('/app/users/me', data),\n    onSuccess: () =&gt; {\n      queryClient.invalidateQueries({ queryKey: queryKeys.user.current });\n    },\n  });\n\n  if (isLoading) return &lt;div&gt;Loading...&lt;/div&gt;;\n  if (!user) return &lt;div&gt;Not found&lt;/div&gt;;\n\n  return (\n    &lt;div&gt;\n      &lt;h1&gt;{user.full_name || 'No name'}&lt;/h1&gt;\n      &lt;p&gt;{user.email}&lt;/p&gt;\n      &lt;p&gt;Plan: {user.subscription_plan || 'Free'}&lt;/p&gt;\n\n      &lt;button\n        onClick={() =&gt; updateMutation.mutate({ full_name: 'New Name' })}\n        disabled={updateMutation.isPending}\n      &gt;\n        Update Name\n      &lt;/button&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#projects-list-with-pagination","title":"Projects List with Pagination","text":"<pre><code>// components/ProjectsList.tsx\n\nexport function ProjectsList() {\n  const [search, setSearch] = useState('');\n  const debouncedSearch = useDebounce(search, 300);\n\n  const {\n    data,\n    isLoading,\n    pagination,\n    page,\n    nextPage,\n    prevPage,\n  } = usePaginatedProjects({\n    search: debouncedSearch,\n  });\n\n  return (\n    &lt;div&gt;\n      &lt;input\n        type=\"search\"\n        placeholder=\"Search projects...\"\n        value={search}\n        onChange={(e) =&gt; setSearch(e.target.value)}\n      /&gt;\n\n      {isLoading ? (\n        &lt;div&gt;Loading...&lt;/div&gt;\n      ) : (\n        &lt;&gt;\n          &lt;ul&gt;\n            {data?.items.map((project) =&gt; (\n              &lt;li key={project.id}&gt;\n                &lt;h3&gt;{project.name}&lt;/h3&gt;\n                &lt;p&gt;{project.description}&lt;/p&gt;\n              &lt;/li&gt;\n            ))}\n          &lt;/ul&gt;\n\n          {pagination &amp;&amp; (\n            &lt;div className=\"pagination\"&gt;\n              &lt;button onClick={prevPage} disabled={!pagination.hasPrev}&gt;\n                Previous\n              &lt;/button&gt;\n              &lt;span&gt;\n                Page {pagination.currentPage} of {pagination.totalPages}\n              &lt;/span&gt;\n              &lt;button onClick={nextPage} disabled={!pagination.hasNext}&gt;\n                Next\n              &lt;/button&gt;\n            &lt;/div&gt;\n          )}\n        &lt;/&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#billing-integration","title":"Billing Integration","text":"<pre><code>// components/BillingSection.tsx\n\nexport function BillingSection() {\n  const { data: status, isLoading } = useQuery({\n    queryKey: queryKeys.billing.status,\n    queryFn: () =&gt; apiClient.get&lt;BillingStatus&gt;('/app/billing/status'),\n  });\n\n  const checkoutMutation = useMutation({\n    mutationFn: (plan: 'monthly' | 'yearly') =&gt;\n      apiClient.post&lt;CheckoutResponse&gt;('/app/billing/checkout', {\n        plan,\n        success_url: `${window.location.origin}/billing/success`,\n        cancel_url: `${window.location.origin}/billing/cancel`,\n      }),\n    onSuccess: (data) =&gt; {\n      // Redirect to Stripe checkout\n      window.location.href = data.url;\n    },\n  });\n\n  const portalMutation = useMutation({\n    mutationFn: () =&gt;\n      apiClient.get&lt;PortalResponse&gt;('/app/billing/portal', {\n        return_url: window.location.href,\n      }),\n    onSuccess: (data) =&gt; {\n      window.location.href = data.url;\n    },\n  });\n\n  if (isLoading) return &lt;div&gt;Loading...&lt;/div&gt;;\n\n  return (\n    &lt;div&gt;\n      &lt;h2&gt;Billing&lt;/h2&gt;\n\n      &lt;p&gt;Current Plan: {status?.plan}&lt;/p&gt;\n      &lt;p&gt;Status: {status?.status || 'No subscription'}&lt;/p&gt;\n\n      {status?.has_active_subscription ? (\n        &lt;button onClick={() =&gt; portalMutation.mutate()}&gt;\n          Manage Subscription\n        &lt;/button&gt;\n      ) : (\n        &lt;div&gt;\n          &lt;button\n            onClick={() =&gt; checkoutMutation.mutate('monthly')}\n            disabled={checkoutMutation.isPending}\n          &gt;\n            Subscribe Monthly ($19/mo)\n          &lt;/button&gt;\n          &lt;button\n            onClick={() =&gt; checkoutMutation.mutate('yearly')}\n            disabled={checkoutMutation.isPending}\n          &gt;\n            Subscribe Yearly ($190/yr)\n          &lt;/button&gt;\n        &lt;/div&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#mobile-react-native","title":"Mobile (React Native)","text":""},{"location":"FRONTEND-INTEGRATION/#api-setup","title":"API Setup","text":"<pre><code>// lib/api.ts (React Native)\n\nimport * as SecureStore from 'expo-secure-store';\n\nconst API_BASE_URL = 'https://api.yourapp.com/api/v1';\n\nasync function getStoredToken(): Promise&lt;string | null&gt; {\n  return SecureStore.getItemAsync('access_token');\n}\n\nexport async function api&lt;T&gt;(\n  endpoint: string,\n  options: RequestInit = {}\n): Promise&lt;T&gt; {\n  const token = await getStoredToken();\n\n  const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n    ...options,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token &amp;&amp; { 'Authorization': `Bearer ${token}` }),\n      ...options.headers,\n    },\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new APIError(error, response.status);\n  }\n\n  if (response.status === 204) {\n    return undefined as T;\n  }\n\n  return response.json();\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#auth-context","title":"Auth Context","text":"<pre><code>// contexts/AuthContext.tsx (React Native)\n\nimport * as SecureStore from 'expo-secure-store';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n  auth: {\n    storage: {\n      async getItem(key) {\n        return SecureStore.getItemAsync(key);\n      },\n      async setItem(key, value) {\n        await SecureStore.setItemAsync(key, value);\n      },\n      async removeItem(key) {\n        await SecureStore.deleteItemAsync(key);\n      },\n    },\n  },\n});\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState&lt;User | null&gt;(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() =&gt; {\n    // Get initial session\n    supabase.auth.getSession().then(({ data: { session } }) =&gt; {\n      if (session?.user) {\n        fetchUser();\n      }\n      setIsLoading(false);\n    });\n\n    // Listen for auth changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) =&gt; {\n        if (session?.user) {\n          await fetchUser();\n        } else {\n          setUser(null);\n        }\n      }\n    );\n\n    return () =&gt; subscription.unsubscribe();\n  }, []);\n\n  const fetchUser = async () =&gt; {\n    try {\n      const user = await api&lt;User&gt;('/app/users/me');\n      setUser(user);\n    } catch (error) {\n      console.error('Failed to fetch user:', error);\n    }\n  };\n\n  const signIn = async (email: string, password: string) =&gt; {\n    const { error } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    });\n    if (error) throw error;\n  };\n\n  const signOut = async () =&gt; {\n    await supabase.auth.signOut();\n    setUser(null);\n  };\n\n  return (\n    &lt;AuthContext.Provider value={{ user, isLoading, signIn, signOut }}&gt;\n      {children}\n    &lt;/AuthContext.Provider&gt;\n  );\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#rate-limiting-handling","title":"Rate Limiting Handling","text":"<pre><code>// lib/rateLimiting.ts\n\ninterface RateLimitState {\n  limit: number;\n  remaining: number;\n  reset: number;\n}\n\nlet rateLimitState: RateLimitState | null = null;\n\n// Update rate limit state from response headers\nfunction updateRateLimitFromResponse(response: Response) {\n  const limit = response.headers.get('X-RateLimit-Limit');\n  const remaining = response.headers.get('X-RateLimit-Remaining');\n  const reset = response.headers.get('X-RateLimit-Reset');\n\n  if (limit &amp;&amp; remaining &amp;&amp; reset) {\n    rateLimitState = {\n      limit: parseInt(limit, 10),\n      remaining: parseInt(remaining, 10),\n      reset: parseInt(reset, 10),\n    };\n  }\n}\n\n// Check if we should wait before making a request\nasync function waitForRateLimit() {\n  if (rateLimitState &amp;&amp; rateLimitState.remaining === 0) {\n    const now = Math.floor(Date.now() / 1000);\n    const waitTime = rateLimitState.reset - now;\n\n    if (waitTime &gt; 0) {\n      await new Promise((resolve) =&gt; setTimeout(resolve, waitTime * 1000));\n    }\n  }\n}\n\n// Enhanced fetch with rate limit handling\nexport async function rateLimitedFetch(\n  url: string,\n  options: RequestInit = {}\n): Promise&lt;Response&gt; {\n  await waitForRateLimit();\n\n  const response = await fetch(url, options);\n  updateRateLimitFromResponse(response);\n\n  if (response.status === 429) {\n    // Rate limited - wait and retry\n    const retryAfter = parseInt(response.headers.get('Retry-After') || '60', 10);\n    await new Promise((resolve) =&gt; setTimeout(resolve, retryAfter * 1000));\n    return rateLimitedFetch(url, options);\n  }\n\n  return response;\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#native-ios-swift","title":"Native iOS (Swift)","text":""},{"location":"FRONTEND-INTEGRATION/#api-client","title":"API Client","text":"<pre><code>// APIClient.swift\nimport Foundation\n\nenum APIError: Error {\n    case invalidURL\n    case noData\n    case decodingError\n    case serverError(code: String, message: String)\n    case unauthorized\n    case networkError(Error)\n}\n\nstruct ErrorResponse: Codable {\n    struct ErrorDetail: Codable {\n        let code: String\n        let message: String\n        let details: [String: String]?\n    }\n    let error: ErrorDetail\n}\n\nclass APIClient {\n    static let shared = APIClient()\n\n    private let baseURL = \"https://api.yourapp.com/api/v1\"\n    private var accessToken: String?\n\n    private init() {}\n\n    func setAccessToken(_ token: String?) {\n        self.accessToken = token\n    }\n\n    func request&lt;T: Codable&gt;(\n        endpoint: String,\n        method: String = \"GET\",\n        body: Encodable? = nil\n    ) async throws -&gt; T {\n        guard let url = URL(string: \"\\(baseURL)\\(endpoint)\") else {\n            throw APIError.invalidURL\n        }\n\n        var request = URLRequest(url: url)\n        request.httpMethod = method\n        request.setValue(\"application/json\", forHTTPHeaderField: \"Content-Type\")\n\n        if let token = accessToken {\n            request.setValue(\"Bearer \\(token)\", forHTTPHeaderField: \"Authorization\")\n        }\n\n        if let body = body {\n            request.httpBody = try JSONEncoder().encode(body)\n        }\n\n        let (data, response) = try await URLSession.shared.data(for: request)\n\n        guard let httpResponse = response as? HTTPURLResponse else {\n            throw APIError.networkError(NSError(domain: \"Invalid response\", code: 0))\n        }\n\n        // Handle 204 No Content\n        if httpResponse.statusCode == 204 {\n            // Return empty response for void types\n            if let emptyResponse = EmptyResponse() as? T {\n                return emptyResponse\n            }\n        }\n\n        // Handle errors\n        if httpResponse.statusCode &gt;= 400 {\n            if httpResponse.statusCode == 401 {\n                throw APIError.unauthorized\n            }\n\n            if let errorResponse = try? JSONDecoder().decode(ErrorResponse.self, from: data) {\n                throw APIError.serverError(\n                    code: errorResponse.error.code,\n                    message: errorResponse.error.message\n                )\n            }\n            throw APIError.serverError(code: \"UNKNOWN\", message: \"Request failed\")\n        }\n\n        do {\n            return try JSONDecoder().decode(T.self, from: data)\n        } catch {\n            throw APIError.decodingError\n        }\n    }\n}\n\nstruct EmptyResponse: Codable {}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#models","title":"Models","text":"<pre><code>// Models.swift\nimport Foundation\n\nstruct User: Codable {\n    let id: String\n    let email: String\n    let fullName: String?\n    let avatarUrl: String?\n    let role: String\n    let isActive: Bool\n    let subscriptionPlan: String?\n    let subscriptionStatus: String?\n    let createdAt: String\n\n    enum CodingKeys: String, CodingKey {\n        case id, email, role\n        case fullName = \"full_name\"\n        case avatarUrl = \"avatar_url\"\n        case isActive = \"is_active\"\n        case subscriptionPlan = \"subscription_plan\"\n        case subscriptionStatus = \"subscription_status\"\n        case createdAt = \"created_at\"\n    }\n}\n\nstruct Project: Codable {\n    let id: String\n    let name: String\n    let description: String?\n    let ownerId: String\n    let createdAt: String\n    let updatedAt: String\n\n    enum CodingKeys: String, CodingKey {\n        case id, name, description\n        case ownerId = \"owner_id\"\n        case createdAt = \"created_at\"\n        case updatedAt = \"updated_at\"\n    }\n}\n\nstruct ProjectCreate: Codable {\n    let name: String\n    let description: String?\n}\n\nstruct ProjectUpdate: Codable {\n    let name: String?\n    let description: String?\n}\n\nstruct PaginatedResponse&lt;T: Codable&gt;: Codable {\n    let items: [T]\n    let total: Int\n    let skip: Int\n    let limit: Int\n}\n\nstruct BillingStatus: Codable {\n    let plan: String\n    let status: String?\n    let currentPeriodEnd: String?\n    let cancelAtPeriodEnd: Bool\n    let hasActiveSubscription: Bool\n\n    enum CodingKeys: String, CodingKey {\n        case plan, status\n        case currentPeriodEnd = \"current_period_end\"\n        case cancelAtPeriodEnd = \"cancel_at_period_end\"\n        case hasActiveSubscription = \"has_active_subscription\"\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#auth-manager-with-supabase","title":"Auth Manager (with Supabase)","text":"<pre><code>// AuthManager.swift\nimport Foundation\nimport Supabase\n\nclass AuthManager: ObservableObject {\n    static let shared = AuthManager()\n\n    private let supabase = SupabaseClient(\n        supabaseURL: URL(string: \"https://xxx.supabase.co\")!,\n        supabaseKey: \"your-anon-key\"\n    )\n\n    @Published var currentUser: User?\n    @Published var isAuthenticated = false\n\n    private init() {\n        Task {\n            await checkSession()\n        }\n    }\n\n    func checkSession() async {\n        do {\n            let session = try await supabase.auth.session\n            APIClient.shared.setAccessToken(session.accessToken)\n            await fetchCurrentUser()\n            await MainActor.run {\n                self.isAuthenticated = true\n            }\n        } catch {\n            await MainActor.run {\n                self.isAuthenticated = false\n            }\n        }\n    }\n\n    func signIn(email: String, password: String) async throws {\n        let session = try await supabase.auth.signIn(\n            email: email,\n            password: password\n        )\n        APIClient.shared.setAccessToken(session.accessToken)\n        await fetchCurrentUser()\n        await MainActor.run {\n            self.isAuthenticated = true\n        }\n    }\n\n    func signOut() async throws {\n        try await supabase.auth.signOut()\n        APIClient.shared.setAccessToken(nil)\n        await MainActor.run {\n            self.currentUser = nil\n            self.isAuthenticated = false\n        }\n    }\n\n    private func fetchCurrentUser() async {\n        do {\n            let user: User = try await APIClient.shared.request(endpoint: \"/app/users/me\")\n            await MainActor.run {\n                self.currentUser = user\n            }\n        } catch {\n            print(\"Failed to fetch user: \\(error)\")\n        }\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#swiftui-views","title":"SwiftUI Views","text":"<pre><code>// ProjectsView.swift\nimport SwiftUI\n\nstruct ProjectsView: View {\n    @State private var projects: [Project] = []\n    @State private var isLoading = true\n    @State private var error: String?\n\n    var body: some View {\n        NavigationView {\n            Group {\n                if isLoading {\n                    ProgressView()\n                } else if let error = error {\n                    Text(error)\n                        .foregroundColor(.red)\n                } else {\n                    List(projects, id: \\.id) { project in\n                        VStack(alignment: .leading) {\n                            Text(project.name)\n                                .font(.headline)\n                            if let description = project.description {\n                                Text(description)\n                                    .font(.subheadline)\n                                    .foregroundColor(.gray)\n                            }\n                        }\n                    }\n                }\n            }\n            .navigationTitle(\"Projects\")\n            .task {\n                await loadProjects()\n            }\n        }\n    }\n\n    private func loadProjects() async {\n        do {\n            let response: PaginatedResponse&lt;Project&gt; = try await APIClient.shared.request(\n                endpoint: \"/app/projects?limit=20\"\n            )\n            await MainActor.run {\n                self.projects = response.items\n                self.isLoading = false\n            }\n        } catch {\n            await MainActor.run {\n                self.error = error.localizedDescription\n                self.isLoading = false\n            }\n        }\n    }\n}\n</code></pre> <pre><code>// CreateProjectView.swift\nimport SwiftUI\n\nstruct CreateProjectView: View {\n    @Environment(\\.dismiss) var dismiss\n    @State private var name = \"\"\n    @State private var description = \"\"\n    @State private var isSubmitting = false\n    @State private var error: String?\n\n    var body: some View {\n        NavigationView {\n            Form {\n                Section {\n                    TextField(\"Project Name\", text: $name)\n                    TextField(\"Description (optional)\", text: $description)\n                }\n\n                if let error = error {\n                    Section {\n                        Text(error)\n                            .foregroundColor(.red)\n                    }\n                }\n            }\n            .navigationTitle(\"New Project\")\n            .toolbar {\n                ToolbarItem(placement: .cancellationAction) {\n                    Button(\"Cancel\") { dismiss() }\n                }\n                ToolbarItem(placement: .confirmationAction) {\n                    Button(\"Create\") {\n                        Task { await createProject() }\n                    }\n                    .disabled(name.isEmpty || isSubmitting)\n                }\n            }\n        }\n    }\n\n    private func createProject() async {\n        isSubmitting = true\n        error = nil\n\n        do {\n            let _: Project = try await APIClient.shared.request(\n                endpoint: \"/app/projects\",\n                method: \"POST\",\n                body: ProjectCreate(\n                    name: name,\n                    description: description.isEmpty ? nil : description\n                )\n            )\n            await MainActor.run {\n                dismiss()\n            }\n        } catch APIError.serverError(let code, let message) {\n            await MainActor.run {\n                self.error = message\n                self.isSubmitting = false\n            }\n        } catch {\n            await MainActor.run {\n                self.error = error.localizedDescription\n                self.isSubmitting = false\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#native-android-kotlin","title":"Native Android (Kotlin)","text":""},{"location":"FRONTEND-INTEGRATION/#dependencies-buildgradlekts","title":"Dependencies (build.gradle.kts)","text":"<pre><code>// app/build.gradle.kts\ndependencies {\n    // Networking\n    implementation(\"com.squareup.retrofit2:retrofit:2.9.0\")\n    implementation(\"com.squareup.retrofit2:converter-gson:2.9.0\")\n    implementation(\"com.squareup.okhttp3:logging-interceptor:4.12.0\")\n\n    // Coroutines\n    implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3\")\n\n    // ViewModel\n    implementation(\"androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0\")\n\n    // Supabase\n    implementation(\"io.github.jan-tennert.supabase:gotrue-kt:2.0.0\")\n    implementation(\"io.ktor:ktor-client-android:2.3.7\")\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#api-models","title":"API Models","text":"<pre><code>// models/ApiModels.kt\npackage com.yourapp.models\n\nimport com.google.gson.annotations.SerializedName\n\ndata class User(\n    val id: String,\n    val email: String,\n    @SerializedName(\"full_name\") val fullName: String?,\n    @SerializedName(\"avatar_url\") val avatarUrl: String?,\n    val role: String,\n    @SerializedName(\"is_active\") val isActive: Boolean,\n    @SerializedName(\"subscription_plan\") val subscriptionPlan: String?,\n    @SerializedName(\"subscription_status\") val subscriptionStatus: String?,\n    @SerializedName(\"created_at\") val createdAt: String\n)\n\ndata class Project(\n    val id: String,\n    val name: String,\n    val description: String?,\n    @SerializedName(\"owner_id\") val ownerId: String,\n    @SerializedName(\"created_at\") val createdAt: String,\n    @SerializedName(\"updated_at\") val updatedAt: String\n)\n\ndata class ProjectCreate(\n    val name: String,\n    val description: String? = null\n)\n\ndata class ProjectUpdate(\n    val name: String? = null,\n    val description: String? = null\n)\n\ndata class PaginatedResponse&lt;T&gt;(\n    val items: List&lt;T&gt;,\n    val total: Int,\n    val skip: Int,\n    val limit: Int\n)\n\ndata class ErrorResponse(\n    val error: ErrorDetail\n)\n\ndata class ErrorDetail(\n    val code: String,\n    val message: String,\n    val details: Map&lt;String, Any&gt;?\n)\n\ndata class BillingStatus(\n    val plan: String,\n    val status: String?,\n    @SerializedName(\"current_period_end\") val currentPeriodEnd: String?,\n    @SerializedName(\"cancel_at_period_end\") val cancelAtPeriodEnd: Boolean,\n    @SerializedName(\"has_active_subscription\") val hasActiveSubscription: Boolean\n)\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#api-service","title":"API Service","text":"<pre><code>// api/ApiService.kt\npackage com.yourapp.api\n\nimport com.yourapp.models.*\nimport retrofit2.Response\nimport retrofit2.http.*\n\ninterface ApiService {\n    // Users\n    @GET(\"app/users/me\")\n    suspend fun getCurrentUser(): User\n\n    @PATCH(\"app/users/me\")\n    suspend fun updateCurrentUser(@Body update: Map&lt;String, String?&gt;): User\n\n    // Projects\n    @GET(\"app/projects\")\n    suspend fun getProjects(\n        @Query(\"skip\") skip: Int = 0,\n        @Query(\"limit\") limit: Int = 20,\n        @Query(\"search\") search: String? = null\n    ): PaginatedResponse&lt;Project&gt;\n\n    @POST(\"app/projects\")\n    suspend fun createProject(@Body project: ProjectCreate): Project\n\n    @GET(\"app/projects/{id}\")\n    suspend fun getProject(@Path(\"id\") id: String): Project\n\n    @PATCH(\"app/projects/{id}\")\n    suspend fun updateProject(\n        @Path(\"id\") id: String,\n        @Body update: ProjectUpdate\n    ): Project\n\n    @DELETE(\"app/projects/{id}\")\n    suspend fun deleteProject(@Path(\"id\") id: String): Response&lt;Unit&gt;\n\n    // Billing\n    @GET(\"app/billing/status\")\n    suspend fun getBillingStatus(): BillingStatus\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#api-client_1","title":"API Client","text":"<pre><code>// api/ApiClient.kt\npackage com.yourapp.api\n\nimport com.google.gson.Gson\nimport com.yourapp.models.ErrorResponse\nimport okhttp3.OkHttpClient\nimport okhttp3.logging.HttpLoggingInterceptor\nimport retrofit2.Retrofit\nimport retrofit2.converter.gson.GsonConverterFactory\n\nobject ApiClient {\n    private const val BASE_URL = \"https://api.yourapp.com/api/v1/\"\n\n    private var accessToken: String? = null\n\n    fun setAccessToken(token: String?) {\n        accessToken = token\n    }\n\n    private val okHttpClient: OkHttpClient by lazy {\n        OkHttpClient.Builder()\n            .addInterceptor { chain -&gt;\n                val originalRequest = chain.request()\n                val requestBuilder = originalRequest.newBuilder()\n                    .header(\"Content-Type\", \"application/json\")\n\n                accessToken?.let {\n                    requestBuilder.header(\"Authorization\", \"Bearer $it\")\n                }\n\n                chain.proceed(requestBuilder.build())\n            }\n            .addInterceptor(HttpLoggingInterceptor().apply {\n                level = HttpLoggingInterceptor.Level.BODY\n            })\n            .build()\n    }\n\n    private val retrofit: Retrofit by lazy {\n        Retrofit.Builder()\n            .baseURL(BASE_URL)\n            .client(okHttpClient)\n            .addConverterFactory(GsonConverterFactory.create())\n            .build()\n    }\n\n    val apiService: ApiService by lazy {\n        retrofit.create(ApiService::class.java)\n    }\n}\n\n// Exception handling\nclass ApiException(\n    val code: String,\n    override val message: String,\n    val details: Map&lt;String, Any&gt;? = null\n) : Exception(message)\n\nsuspend fun &lt;T&gt; safeApiCall(apiCall: suspend () -&gt; T): Result&lt;T&gt; {\n    return try {\n        Result.success(apiCall())\n    } catch (e: retrofit2.HttpException) {\n        val errorBody = e.response()?.errorBody()?.string()\n        val errorResponse = try {\n            Gson().fromJson(errorBody, ErrorResponse::class.java)\n        } catch (ex: Exception) {\n            null\n        }\n\n        Result.failure(\n            ApiException(\n                code = errorResponse?.error?.code ?: \"UNKNOWN\",\n                message = errorResponse?.error?.message ?: \"Request failed\",\n                details = errorResponse?.error?.details\n            )\n        )\n    } catch (e: Exception) {\n        Result.failure(e)\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#auth-manager-with-supabase_1","title":"Auth Manager (with Supabase)","text":"<pre><code>// auth/AuthManager.kt\npackage com.yourapp.auth\n\nimport com.yourapp.api.ApiClient\nimport com.yourapp.models.User\nimport io.github.jan.supabase.createSupabaseClient\nimport io.github.jan.supabase.gotrue.Auth\nimport io.github.jan.supabase.gotrue.auth\nimport io.github.jan.supabase.gotrue.providers.builtin.Email\nimport kotlinx.coroutines.flow.MutableStateFlow\nimport kotlinx.coroutines.flow.StateFlow\n\nobject AuthManager {\n    private val supabase = createSupabaseClient(\n        supabaseUrl = \"https://xxx.supabase.co\",\n        supabaseKey = \"your-anon-key\"\n    ) {\n        install(Auth)\n    }\n\n    private val _currentUser = MutableStateFlow&lt;User?&gt;(null)\n    val currentUser: StateFlow&lt;User?&gt; = _currentUser\n\n    private val _isAuthenticated = MutableStateFlow(false)\n    val isAuthenticated: StateFlow&lt;Boolean&gt; = _isAuthenticated\n\n    suspend fun checkSession() {\n        try {\n            val session = supabase.auth.currentSessionOrNull()\n            if (session != null) {\n                ApiClient.setAccessToken(session.accessToken)\n                fetchCurrentUser()\n                _isAuthenticated.value = true\n            }\n        } catch (e: Exception) {\n            _isAuthenticated.value = false\n        }\n    }\n\n    suspend fun signIn(email: String, password: String) {\n        supabase.auth.signInWith(Email) {\n            this.email = email\n            this.password = password\n        }\n\n        val session = supabase.auth.currentSessionOrNull()\n        ApiClient.setAccessToken(session?.accessToken)\n        fetchCurrentUser()\n        _isAuthenticated.value = true\n    }\n\n    suspend fun signOut() {\n        supabase.auth.signOut()\n        ApiClient.setAccessToken(null)\n        _currentUser.value = null\n        _isAuthenticated.value = false\n    }\n\n    private suspend fun fetchCurrentUser() {\n        try {\n            val user = ApiClient.apiService.getCurrentUser()\n            _currentUser.value = user\n        } catch (e: Exception) {\n            // Handle error\n        }\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#viewmodel","title":"ViewModel","text":"<pre><code>// viewmodels/ProjectsViewModel.kt\npackage com.yourapp.viewmodels\n\nimport androidx.lifecycle.ViewModel\nimport androidx.lifecycle.viewModelScope\nimport com.yourapp.api.ApiClient\nimport com.yourapp.api.safeApiCall\nimport com.yourapp.models.Project\nimport com.yourapp.models.ProjectCreate\nimport kotlinx.coroutines.flow.MutableStateFlow\nimport kotlinx.coroutines.flow.StateFlow\nimport kotlinx.coroutines.launch\n\nclass ProjectsViewModel : ViewModel() {\n\n    private val _projects = MutableStateFlow&lt;List&lt;Project&gt;&gt;(emptyList())\n    val projects: StateFlow&lt;List&lt;Project&gt;&gt; = _projects\n\n    private val _isLoading = MutableStateFlow(false)\n    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading\n\n    private val _error = MutableStateFlow&lt;String?&gt;(null)\n    val error: StateFlow&lt;String?&gt; = _error\n\n    private val _total = MutableStateFlow(0)\n    val total: StateFlow&lt;Int&gt; = _total\n\n    fun loadProjects(skip: Int = 0, limit: Int = 20) {\n        viewModelScope.launch {\n            _isLoading.value = true\n            _error.value = null\n\n            val result = safeApiCall {\n                ApiClient.apiService.getProjects(skip = skip, limit = limit)\n            }\n\n            result.onSuccess { response -&gt;\n                _projects.value = response.items\n                _total.value = response.total\n            }.onFailure { e -&gt;\n                _error.value = e.message\n            }\n\n            _isLoading.value = false\n        }\n    }\n\n    fun createProject(name: String, description: String?, onSuccess: () -&gt; Unit) {\n        viewModelScope.launch {\n            _isLoading.value = true\n\n            val result = safeApiCall {\n                ApiClient.apiService.createProject(\n                    ProjectCreate(name = name, description = description)\n                )\n            }\n\n            result.onSuccess {\n                loadProjects() // Refresh list\n                onSuccess()\n            }.onFailure { e -&gt;\n                _error.value = e.message\n            }\n\n            _isLoading.value = false\n        }\n    }\n\n    fun deleteProject(projectId: String) {\n        viewModelScope.launch {\n            val result = safeApiCall {\n                ApiClient.apiService.deleteProject(projectId)\n            }\n\n            result.onSuccess {\n                // Remove from local list\n                _projects.value = _projects.value.filter { it.id != projectId }\n            }.onFailure { e -&gt;\n                _error.value = e.message\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"FRONTEND-INTEGRATION/#jetpack-compose-ui","title":"Jetpack Compose UI","text":"<pre><code>// ui/ProjectsScreen.kt\npackage com.yourapp.ui\n\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.lazy.LazyColumn\nimport androidx.compose.foundation.lazy.items\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.unit.dp\nimport androidx.lifecycle.viewmodel.compose.viewModel\nimport com.yourapp.viewmodels.ProjectsViewModel\n\n@OptIn(ExperimentalMaterial3Api::class)\n@Composable\nfun ProjectsScreen(\n    viewModel: ProjectsViewModel = viewModel()\n) {\n    val projects by viewModel.projects.collectAsState()\n    val isLoading by viewModel.isLoading.collectAsState()\n    val error by viewModel.error.collectAsState()\n\n    var showCreateDialog by remember { mutableStateOf(false) }\n\n    LaunchedEffect(Unit) {\n        viewModel.loadProjects()\n    }\n\n    Scaffold(\n        topBar = {\n            TopAppBar(title = { Text(\"Projects\") })\n        },\n        floatingActionButton = {\n            FloatingActionButton(onClick = { showCreateDialog = true }) {\n                Text(\"+\")\n            }\n        }\n    ) { padding -&gt;\n        Box(\n            modifier = Modifier\n                .fillMaxSize()\n                .padding(padding)\n        ) {\n            when {\n                isLoading -&gt; {\n                    CircularProgressIndicator(\n                        modifier = Modifier.align(Alignment.Center)\n                    )\n                }\n                error != null -&gt; {\n                    Text(\n                        text = error ?: \"Error\",\n                        color = MaterialTheme.colorScheme.error,\n                        modifier = Modifier.align(Alignment.Center)\n                    )\n                }\n                else -&gt; {\n                    LazyColumn {\n                        items(projects) { project -&gt;\n                            ProjectItem(\n                                project = project,\n                                onDelete = { viewModel.deleteProject(project.id) }\n                            )\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    if (showCreateDialog) {\n        CreateProjectDialog(\n            onDismiss = { showCreateDialog = false },\n            onCreate = { name, description -&gt;\n                viewModel.createProject(name, description) {\n                    showCreateDialog = false\n                }\n            }\n        )\n    }\n}\n\n@Composable\nfun ProjectItem(\n    project: com.yourapp.models.Project,\n    onDelete: () -&gt; Unit\n) {\n    Card(\n        modifier = Modifier\n            .fillMaxWidth()\n            .padding(8.dp)\n    ) {\n        Column(modifier = Modifier.padding(16.dp)) {\n            Text(\n                text = project.name,\n                style = MaterialTheme.typography.titleMedium\n            )\n            project.description?.let {\n                Spacer(modifier = Modifier.height(4.dp))\n                Text(\n                    text = it,\n                    style = MaterialTheme.typography.bodyMedium\n                )\n            }\n            Spacer(modifier = Modifier.height(8.dp))\n            TextButton(onClick = onDelete) {\n                Text(\"Delete\", color = MaterialTheme.colorScheme.error)\n            }\n        }\n    }\n}\n\n@Composable\nfun CreateProjectDialog(\n    onDismiss: () -&gt; Unit,\n    onCreate: (name: String, description: String?) -&gt; Unit\n) {\n    var name by remember { mutableStateOf(\"\") }\n    var description by remember { mutableStateOf(\"\") }\n\n    AlertDialog(\n        onDismissRequest = onDismiss,\n        title = { Text(\"New Project\") },\n        text = {\n            Column {\n                OutlinedTextField(\n                    value = name,\n                    onValueChange = { name = it },\n                    label = { Text(\"Name\") },\n                    modifier = Modifier.fillMaxWidth()\n                )\n                Spacer(modifier = Modifier.height(8.dp))\n                OutlinedTextField(\n                    value = description,\n                    onValueChange = { description = it },\n                    label = { Text(\"Description (optional)\") },\n                    modifier = Modifier.fillMaxWidth()\n                )\n            }\n        },\n        confirmButton = {\n            TextButton(\n                onClick = {\n                    onCreate(name, description.ifBlank { null })\n                },\n                enabled = name.isNotBlank()\n            ) {\n                Text(\"Create\")\n            }\n        },\n        dismissButton = {\n            TextButton(onClick = onDismiss) {\n                Text(\"Cancel\")\n            }\n        }\n    )\n}\n</code></pre>"},{"location":"GETTING-STARTED/","title":"Getting Started","text":"<p>Complete guide to set up and run OmniStack Backend.</p>"},{"location":"GETTING-STARTED/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Prerequisites</li> <li>Quick Start (60 Seconds)</li> <li>Environment Variables</li> <li>Running the Application</li> <li>Verifying the Setup</li> <li>Next Steps</li> </ol>"},{"location":"GETTING-STARTED/#prerequisites","title":"Prerequisites","text":""},{"location":"GETTING-STARTED/#required-software","title":"Required Software","text":"Software Version Check Command Python 3.12+ <code>python --version</code> Docker 20.10+ <code>docker --version</code> Docker Compose 2.0+ <code>docker compose version</code>"},{"location":"GETTING-STARTED/#recommended-tools","title":"Recommended Tools","text":"Tool Purpose uv Fast Python package installer HTTPie CLI for HTTP requests pgAdmin PostgreSQL GUI RedisInsight Redis GUI"},{"location":"GETTING-STARTED/#quick-start-60-seconds","title":"Quick Start (60 Seconds)","text":"<pre><code># 1. Clone the repository\ngit clone https://github.com/your-org/backend-boilerplate-fastapi.git\ncd backend-boilerplate-fastapi\n\n# 2. Create virtual environment\nmake venv\n\n# 3. Activate virtual environment\nsource .venv/bin/activate\n\n# 4. Install dependencies\nmake install\n\n# 5. Copy environment file\ncp .env.example .env\n\n# 6. Start Docker services (PostgreSQL + Redis)\nmake up\n\n# 7. Run the API server\nmake dev\n</code></pre> <p>That's it! Your API is running at <code>http://localhost:8000</code></p> <ul> <li>Swagger UI: http://localhost:8000/docs</li> <li>Health Check: http://localhost:8000/api/v1/public/health</li> </ul>"},{"location":"GETTING-STARTED/#environment-variables","title":"Environment Variables","text":""},{"location":"GETTING-STARTED/#minimal-setup","title":"Minimal Setup","text":"<p>Create a <code>.env</code> file with these essential variables:</p> <pre><code># .env\n\n# Core (REQUIRED)\nSECRET_KEY=\"your-secret-key-at-least-32-characters-long\"\nDATABASE_URL=\"postgresql+asyncpg://postgres:postgres@localhost:5432/omnistack\"\n\n# Optional but recommended\nREDIS_URL=\"redis://localhost:6379/0\"\nENVIRONMENT=\"local\"\nDEBUG=\"true\"\n</code></pre>"},{"location":"GETTING-STARTED/#full-configuration","title":"Full Configuration","text":"Click to expand full environment variables <pre><code># ============================================\n# CORE SETTINGS\n# ============================================\nPROJECT_NAME=\"My SaaS API\"\nENVIRONMENT=\"local\"                    # local | staging | production\nDEBUG=\"true\"                           # Enable debug mode\nLOG_LEVEL=\"INFO\"                       # DEBUG | INFO | WARNING | ERROR\nSECRET_KEY=\"your-secret-key-minimum-32-characters\"\n\n# ============================================\n# DATABASE\n# ============================================\nDATABASE_URL=\"postgresql+asyncpg://postgres:postgres@localhost:5432/omnistack\"\nDB_POOL_SIZE=\"10\"                      # Connection pool size\nDB_POOL_RECYCLE=\"3600\"                 # Recycle connections (seconds)\nDB_USE_NULL_POOL=\"false\"               # true for serverless (Neon, Supabase)\n\n# ============================================\n# REDIS / CACHE\n# ============================================\nREDIS_URL=\"redis://localhost:6379/0\"\n\n# ============================================\n# AUTHENTICATION\n# ============================================\nAUTH_PROVIDER=\"supabase\"               # supabase | clerk | custom\n\n# Supabase Auth\nSUPABASE_PROJECT_URL=\"https://xxx.supabase.co\"\nSUPABASE_JWT_SECRET=\"\"                 # Only for legacy HS256\n\n# Clerk Auth\nCLERK_ISSUER_URL=\"https://xxx.clerk.accounts.dev\"\nCLERK_SECRET_KEY=\"\"\n\n# ============================================\n# AI PROVIDERS (Optional)\n# ============================================\nAI_DEFAULT_PROVIDER=\"openai\"           # openai | anthropic | gemini\nAI_DEFAULT_MODEL=\"gpt-4o\"\nOPENAI_API_KEY=\"\"\nANTHROPIC_API_KEY=\"\"\nGOOGLE_API_KEY=\"\"\n\n# ============================================\n# EMAIL (Optional)\n# ============================================\nEMAIL_PROVIDER=\"console\"               # resend | sendgrid | console\nEMAIL_FROM_ADDRESS=\"hello@example.com\"\nEMAIL_FROM_NAME=\"My App\"\nRESEND_API_KEY=\"\"\nSENDGRID_API_KEY=\"\"\n\n# ============================================\n# STORAGE (Optional)\n# ============================================\nSTORAGE_PROVIDER=\"local\"               # s3 | r2 | cloudinary | local\nAWS_ACCESS_KEY_ID=\"\"\nAWS_SECRET_ACCESS_KEY=\"\"\nAWS_REGION=\"us-east-1\"\nAWS_S3_BUCKET=\"\"\n\n# ============================================\n# STRIPE (Optional)\n# ============================================\nSTRIPE_SECRET_KEY=\"\"\nSTRIPE_WEBHOOK_SECRET=\"\"\nSTRIPE_PRICE_ID_MONTHLY=\"\"\nSTRIPE_PRICE_ID_YEARLY=\"\"\n\n# ============================================\n# OBSERVABILITY (Optional)\n# ============================================\nSENTRY_DSN=\"\"\nSENTRY_TRACES_SAMPLE_RATE=\"0.1\"\n\n# ============================================\n# RATE LIMITING\n# ============================================\nRATE_LIMIT_DEFAULT=\"60/minute\"\nRATE_LIMIT_AI=\"10/minute\"\nRATE_LIMIT_AUTH=\"5/minute\"\n\n# ============================================\n# CORS\n# ============================================\nBACKEND_CORS_ORIGINS='[\"http://localhost:3000\"]'\n</code></pre>"},{"location":"GETTING-STARTED/#environment-specific-files","title":"Environment-Specific Files","text":"File Purpose Git Status <code>.env.example</code> Template with all variables Committed <code>.env</code> Local development Ignored <code>.env.test</code> Test environment Ignored <code>.env.production</code> Production (reference) Ignored"},{"location":"GETTING-STARTED/#running-the-application","title":"Running the Application","text":""},{"location":"GETTING-STARTED/#development-mode-recommended","title":"Development Mode (Recommended)","text":"<pre><code># Start database and cache\nmake up\n\n# Run API with hot reload\nmake dev\n\n# API available at http://localhost:8000\n</code></pre>"},{"location":"GETTING-STARTED/#using-docker","title":"Using Docker","text":"<pre><code># Build and run everything in Docker\ndocker compose -f docker/docker-compose.yml up\n\n# Or build production image\ndocker build -f docker/Dockerfile -t omnistack-api .\ndocker run -p 8000:8000 --env-file .env omnistack-api\n</code></pre>"},{"location":"GETTING-STARTED/#background-worker","title":"Background Worker","text":"<p>For background jobs (emails, reports, etc.):</p> <pre><code># Terminal 1: API server\nmake dev\n\n# Terminal 2: Background worker\nmake worker\n</code></pre>"},{"location":"GETTING-STARTED/#verifying-the-setup","title":"Verifying the Setup","text":""},{"location":"GETTING-STARTED/#1-health-check","title":"1. Health Check","text":"<pre><code>curl http://localhost:8000/api/v1/public/health\n</code></pre> <p>Expected response: <pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2026-01-10T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"GETTING-STARTED/#2-readiness-check-with-dbredis","title":"2. Readiness Check (with DB/Redis)","text":"<pre><code>curl http://localhost:8000/api/v1/public/health/ready\n</code></pre> <p>Expected response: <pre><code>{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2026-01-10T12:00:00Z\",\n  \"components\": {\n    \"database\": { \"status\": \"healthy\" },\n    \"cache\": { \"status\": \"healthy\" }\n  }\n}\n</code></pre></p>"},{"location":"GETTING-STARTED/#3-swagger-ui","title":"3. Swagger UI","text":"<p>Open http://localhost:8000/docs in your browser to see the interactive API documentation.</p>"},{"location":"GETTING-STARTED/#4-run-tests","title":"4. Run Tests","text":"<pre><code># Run all tests\nmake test\n\n# Run with coverage\npytest tests/ --cov=app --cov-report=html\n\n# Run specific test file\npytest tests/unit/test_health.py -v\n</code></pre>"},{"location":"GETTING-STARTED/#5-lint-check","title":"5. Lint Check","text":"<pre><code>make lint\n</code></pre>"},{"location":"GETTING-STARTED/#make-commands-reference","title":"Make Commands Reference","text":"Command Description <code>make venv</code> Create Python virtual environment <code>make install</code> Install all dependencies <code>make dev</code> Run API with hot reload <code>make up</code> Start Docker services (DB + Redis) <code>make down</code> Stop Docker services <code>make test</code> Run test suite <code>make lint</code> Run linter (Ruff) <code>make worker</code> Start background worker <code>make worker-dev</code> Start worker with auto-reload <code>make migrate msg=\"description\"</code> Generate and run migration"},{"location":"GETTING-STARTED/#project-structure-overview","title":"Project Structure Overview","text":"<pre><code>backend-boilerplate-fastapi/\n\u251c\u2500\u2500 app/                      # Application code\n\u2502   \u251c\u2500\u2500 main.py               # FastAPI app entry point\n\u2502   \u251c\u2500\u2500 api/                  # HTTP endpoints\n\u2502   \u2502   \u251c\u2500\u2500 deps.py           # Dependencies (auth, db session)\n\u2502   \u2502   \u2514\u2500\u2500 v1/               # API version 1\n\u2502   \u2502       \u251c\u2500\u2500 public/       # No auth required\n\u2502   \u2502       \u251c\u2500\u2500 app/          # Auth required\n\u2502   \u2502       \u2514\u2500\u2500 admin/        # Admin only\n\u2502   \u251c\u2500\u2500 core/                 # Core utilities\n\u2502   \u2502   \u251c\u2500\u2500 config.py         # Environment configuration\n\u2502   \u2502   \u251c\u2500\u2500 db.py             # Database setup\n\u2502   \u2502   \u251c\u2500\u2500 security.py       # JWT verification\n\u2502   \u2502   \u2514\u2500\u2500 exceptions.py     # Custom exceptions\n\u2502   \u251c\u2500\u2500 models/               # Database models (SQLModel)\n\u2502   \u251c\u2500\u2500 schemas/              # Request/response schemas\n\u2502   \u251c\u2500\u2500 business/             # Business logic services\n\u2502   \u251c\u2500\u2500 services/             # External service adapters\n\u2502   \u2502   \u251c\u2500\u2500 ai/               # AI providers\n\u2502   \u2502   \u251c\u2500\u2500 email/            # Email providers\n\u2502   \u2502   \u251c\u2500\u2500 storage/          # Storage providers\n\u2502   \u2502   \u2514\u2500\u2500 payments/         # Payment providers\n\u2502   \u2514\u2500\u2500 jobs/                 # Background tasks\n\u251c\u2500\u2500 migrations/               # Alembic migrations\n\u251c\u2500\u2500 tests/                    # Test suite\n\u251c\u2500\u2500 docker/                   # Docker configuration\n\u251c\u2500\u2500 documentation/            # Documentation (you are here)\n\u2514\u2500\u2500 .env.example              # Environment template\n</code></pre>"},{"location":"GETTING-STARTED/#database-setup","title":"Database Setup","text":""},{"location":"GETTING-STARTED/#run-migrations","title":"Run Migrations","text":"<pre><code># Apply all pending migrations\nalembic upgrade head\n\n# Check current revision\nalembic current\n\n# View migration history\nalembic history\n</code></pre>"},{"location":"GETTING-STARTED/#create-new-migration","title":"Create New Migration","text":"<pre><code># Auto-generate migration from model changes\nmake migrate msg=\"add user profile fields\"\n\n# Or manually\nalembic revision --autogenerate -m \"description\"\nalembic upgrade head\n</code></pre>"},{"location":"GETTING-STARTED/#reset-database-development","title":"Reset Database (Development)","text":"<pre><code># Warning: This deletes all data\nmake down\ndocker volume rm backend-boilerplate-fastapi_postgres_data\nmake up\nalembic upgrade head\n</code></pre>"},{"location":"GETTING-STARTED/#troubleshooting","title":"Troubleshooting","text":""},{"location":"GETTING-STARTED/#port-already-in-use","title":"Port Already in Use","text":"<pre><code># Find process using port 8000\nlsof -i :8000\n\n# Kill it\nkill -9 &lt;PID&gt;\n</code></pre>"},{"location":"GETTING-STARTED/#local-postgresql-conflict","title":"Local PostgreSQL Conflict","text":"<p>If you have local PostgreSQL running (Homebrew), it conflicts with Docker:</p> <pre><code># Stop local PostgreSQL\nbrew services stop postgresql@17  # or your version\n\n# Then start Docker services\nmake up\n</code></pre>"},{"location":"GETTING-STARTED/#module-not-found","title":"Module Not Found","text":"<pre><code># Make sure virtual environment is activated\nsource .venv/bin/activate\n\n# Reinstall dependencies\npip install -e \".[dev]\"\n</code></pre>"},{"location":"GETTING-STARTED/#database-connection-failed","title":"Database Connection Failed","text":"<ol> <li>Check Docker is running: <code>docker ps</code></li> <li>Check DATABASE_URL in <code>.env</code></li> <li>Try reconnecting: <code>make down &amp;&amp; make up</code></li> </ol>"},{"location":"GETTING-STARTED/#redis-connection-failed","title":"Redis Connection Failed","text":"<p>Redis is optional. The app works without it (rate limiting falls back to memory).</p> <p>To enable Redis: <pre><code># Make sure REDIS_URL is set in .env\nREDIS_URL=\"redis://localhost:6379/0\"\n\n# Check Redis is running\ndocker ps | grep redis\n</code></pre></p>"},{"location":"GETTING-STARTED/#next-steps","title":"Next Steps","text":"<ol> <li>Configure Authentication</li> <li>Set up Supabase or Clerk</li> <li> <p>Update <code>AUTH_PROVIDER</code> and related env vars</p> </li> <li> <p>Read the Architecture Guide</p> </li> <li>Architecture Documentation</li> <li> <p>Learn naming conventions and patterns</p> </li> <li> <p>Explore the API</p> </li> <li>API Reference</li> <li> <p>Test endpoints in Swagger UI</p> </li> <li> <p>Customize for Your Needs</p> </li> <li>Modular Guide</li> <li> <p>Remove components you don't need</p> </li> <li> <p>Frontend Integration</p> </li> <li>Frontend Integration Guide</li> <li>TypeScript types and examples</li> </ol>"},{"location":"GETTING-STARTED/#getting-help","title":"Getting Help","text":"<ul> <li>Check the API Reference for endpoint details</li> <li>Review Architecture for code patterns</li> <li>Open an issue on GitHub for bugs</li> <li>Read the inline code documentation</li> </ul>"},{"location":"MODULAR-GUIDE/","title":"Modular Guide: Pick &amp; Choose Components","text":"<p>This boilerplate is designed like Lego blocks. You can easily pick and choose only what you need.</p>"},{"location":"MODULAR-GUIDE/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Architecture Overview</li> <li>Component Map</li> <li>Common Configurations</li> <li>Removal Instructions</li> <li>Minimal Setups</li> <li>Adding Components Back</li> </ol>"},{"location":"MODULAR-GUIDE/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              CORE (Required)                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  app/core/    \u2502  app/api/deps.py  \u2502  app/models/base.py        \u2502   \u2502\n\u2502  \u2502  config.py    \u2502  DBSession        \u2502  BaseModel                  \u2502   \u2502\n\u2502  \u2502  db.py        \u2502  CurrentUser      \u2502  SoftDeleteMixin            \u2502   \u2502\n\u2502  \u2502  security.py  \u2502  CurrentUserId    \u2502                             \u2502   \u2502\n\u2502  \u2502  exceptions.py\u2502                   \u2502                             \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                           \u2502                           \u2502\n        \u25bc                           \u25bc                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   AUTH MODULE     \u2502   \u2502   CRUD PATTERNS   \u2502   \u2502  MIDDLEWARE       \u2502\n\u2502   (Required)      \u2502   \u2502   (Required)      \u2502   \u2502  (Recommended)    \u2502\n\u2502                   \u2502   \u2502                   \u2502   \u2502                   \u2502\n\u2502 - User model      \u2502   \u2502 - crud_base.py    \u2502   \u2502 - Rate limiting   \u2502\n\u2502 - JWT verify      \u2502   \u2502 - Generic CRUD    \u2502   \u2502 - Request ID      \u2502\n\u2502 - User sync       \u2502   \u2502 - Pagination      \u2502   \u2502 - Logging         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 - Security headers\u2502\n                                                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                           \u2502                           \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502                               \u2502                               \u2502\n    \u25bc                               \u25bc                               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AI MODULE  \u2502 \u2502EMAIL MODULE \u2502 \u2502STORAGE MOD. \u2502 \u2502PAYMENT MOD. \u2502 \u2502  JOBS MOD.  \u2502\n\u2502 (Optional)  \u2502 \u2502 (Optional)  \u2502 \u2502 (Optional)  \u2502 \u2502 (Optional)  \u2502 \u2502 (Optional)  \u2502\n\u2502             \u2502 \u2502             \u2502 \u2502             \u2502 \u2502             \u2502 \u2502             \u2502\n\u2502 - OpenAI    \u2502 \u2502 - Resend    \u2502 \u2502 - S3        \u2502 \u2502 - Stripe    \u2502 \u2502 - ARQ       \u2502\n\u2502 - Anthropic \u2502 \u2502 - SendGrid  \u2502 \u2502 - R2        \u2502 \u2502 - Apple IAP \u2502 \u2502 - Cron jobs \u2502\n\u2502 - Gemini    \u2502 \u2502 - Templates \u2502 \u2502 - Cloudinary\u2502 \u2502 - Google IAP\u2502 \u2502 - Email jobs\u2502\n\u2502 - Router    \u2502 \u2502             \u2502 \u2502 - Local     \u2502 \u2502             \u2502 \u2502             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"MODULAR-GUIDE/#component-map","title":"Component Map","text":""},{"location":"MODULAR-GUIDE/#core-components-required","title":"Core Components (Required)","text":"<p>These are the foundation - always keep them:</p> Component Files Purpose Config <code>app/core/config.py</code> Environment configuration Database <code>app/core/db.py</code> Async database connection Security <code>app/core/security.py</code> JWT verification Exceptions <code>app/core/exceptions.py</code> Error handling Base Model <code>app/models/base.py</code> BaseModel, SoftDeleteMixin Dependencies <code>app/api/deps.py</code> DBSession, CurrentUser CRUD Base <code>app/business/crud_base.py</code> Generic CRUD operations"},{"location":"MODULAR-GUIDE/#optional-components","title":"Optional Components","text":"Component Files Dependencies When to Remove AI Gateway <code>app/services/ai/</code>, <code>app/api/v1/app/ai.py</code>, <code>app/schemas/ai.py</code> openai, anthropic No AI features needed Email Service <code>app/services/email/</code>, <code>app/jobs/email_jobs.py</code> resend, sendgrid, jinja2 Using Supabase/Clerk email or none Storage Service <code>app/services/storage/</code>, <code>app/api/v1/app/files.py</code>, <code>app/models/file.py</code> aioboto3, cloudinary Using Supabase Storage or none Stripe Payments <code>app/services/payments/stripe_service.py</code>, <code>app/business/billing_service.py</code>, <code>app/api/v1/app/billing.py</code> stripe No web payments Apple IAP <code>app/services/payments/apple_iap_service.py</code>, part of <code>app/business/iap_service.py</code> None No iOS app Google IAP <code>app/services/payments/google_iap_service.py</code>, part of <code>app/business/iap_service.py</code> None No Android app Background Jobs <code>app/jobs/</code> arq No async processing needed Prometheus Metrics <code>app/core/metrics.py</code>, <code>app/api/v1/public/metrics.py</code> prometheus-client No metrics needed Sentry <code>app/core/sentry.py</code> sentry-sdk No error tracking needed Load Tests <code>tests/load/</code> locust No load testing"},{"location":"MODULAR-GUIDE/#common-configurations","title":"Common Configurations","text":""},{"location":"MODULAR-GUIDE/#config-1-api-only-minimal","title":"Config 1: API Only (Minimal)","text":"<p>For a simple REST API without external services.</p> <p>Keep: - Core (config, db, security, exceptions) - User model and endpoints - CRUD patterns - Health endpoints</p> <p>Remove: - AI Gateway - Email Service - Storage Service - Payments (all) - Background Jobs - Observability</p> <p>Resulting structure: <pre><code>app/\n\u251c\u2500\u2500 api/v1/\n\u2502   \u251c\u2500\u2500 public/health.py\n\u2502   \u2514\u2500\u2500 app/users.py\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 config.py, db.py, security.py, exceptions.py\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 base.py, user.py\n\u251c\u2500\u2500 business/\n\u2502   \u251c\u2500\u2500 crud_base.py, user_service.py\n\u2514\u2500\u2500 main.py\n</code></pre></p>"},{"location":"MODULAR-GUIDE/#config-2-saas-backend-postgres-stripe-auth","title":"Config 2: SaaS Backend (Postgres + Stripe + Auth)","text":"<p>For a typical SaaS application with subscriptions.</p> <p>Keep: - Core (all) - User, Project models - Stripe payments - Billing endpoints - Webhooks (Stripe, Supabase/Clerk) - Background jobs (optional)</p> <p>Remove: - AI Gateway - Email Service (or keep for transactional emails) - Storage Service - Apple/Google IAP - Load tests</p> <p>Resulting structure: <pre><code>app/\n\u251c\u2500\u2500 api/v1/\n\u2502   \u251c\u2500\u2500 public/\n\u2502   \u2502   \u251c\u2500\u2500 health.py\n\u2502   \u2502   \u2514\u2500\u2500 webhooks.py      # Stripe + Auth webhooks\n\u2502   \u251c\u2500\u2500 app/\n\u2502   \u2502   \u251c\u2500\u2500 users.py\n\u2502   \u2502   \u251c\u2500\u2500 projects.py\n\u2502   \u2502   \u2514\u2500\u2500 billing.py\n\u2502   \u2514\u2500\u2500 admin/users.py\n\u251c\u2500\u2500 core/                     # Keep all\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 base.py, user.py, project.py\n\u2502   \u2514\u2500\u2500 webhook_event.py\n\u251c\u2500\u2500 business/\n\u2502   \u251c\u2500\u2500 crud_base.py\n\u2502   \u251c\u2500\u2500 user_service.py\n\u2502   \u251c\u2500\u2500 project_service.py\n\u2502   \u2514\u2500\u2500 billing_service.py\n\u251c\u2500\u2500 services/payments/\n\u2502   \u2514\u2500\u2500 stripe_service.py\n\u2514\u2500\u2500 jobs/                     # Optional\n</code></pre></p>"},{"location":"MODULAR-GUIDE/#config-3-ai-application","title":"Config 3: AI Application","text":"<p>For an AI-powered application.</p> <p>Keep: - Core (all) - AI Gateway - User model - Rate limiting (important for AI)</p> <p>Remove: - Storage Service (unless storing generated content) - Payments (unless monetizing AI) - Email Service - Apple/Google IAP</p> <p>Resulting structure: <pre><code>app/\n\u251c\u2500\u2500 api/v1/\n\u2502   \u251c\u2500\u2500 public/health.py\n\u2502   \u2514\u2500\u2500 app/\n\u2502       \u251c\u2500\u2500 users.py\n\u2502       \u2514\u2500\u2500 ai.py\n\u251c\u2500\u2500 core/                     # Keep all, especially rate limiting\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 base.py, user.py\n\u251c\u2500\u2500 business/\n\u2502   \u251c\u2500\u2500 crud_base.py, user_service.py\n\u251c\u2500\u2500 services/ai/             # Keep all providers you need\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 openai_provider.py\n\u2502   \u251c\u2500\u2500 anthropic_provider.py\n\u2502   \u251c\u2500\u2500 router.py\n\u2502   \u2514\u2500\u2500 factory.py\n\u2514\u2500\u2500 schemas/ai.py\n</code></pre></p>"},{"location":"MODULAR-GUIDE/#config-4-mobile-app-backend","title":"Config 4: Mobile App Backend","text":"<p>For iOS/Android app with in-app purchases.</p> <p>Keep: - Core (all) - User model (with IAP fields) - Apple IAP service - Google IAP service - IAP business logic - Apple/Google webhooks - Background jobs (for sync)</p> <p>Remove: - AI Gateway - Stripe (unless also have web) - Email Service (push notifications instead) - Storage Service (unless user uploads)</p> <p>Resulting structure: <pre><code>app/\n\u251c\u2500\u2500 api/v1/\n\u2502   \u251c\u2500\u2500 public/\n\u2502   \u2502   \u251c\u2500\u2500 health.py\n\u2502   \u2502   \u2514\u2500\u2500 webhooks.py      # Apple + Google webhooks\n\u2502   \u2514\u2500\u2500 app/users.py\n\u251c\u2500\u2500 core/                     # Keep all\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 user.py              # With apple_original_transaction_id, google_purchase_token\n\u2502   \u2514\u2500\u2500 webhook_event.py\n\u251c\u2500\u2500 business/\n\u2502   \u251c\u2500\u2500 crud_base.py\n\u2502   \u251c\u2500\u2500 user_service.py\n\u2502   \u2514\u2500\u2500 iap_service.py\n\u251c\u2500\u2500 services/payments/\n\u2502   \u251c\u2500\u2500 apple_iap_service.py\n\u2502   \u2514\u2500\u2500 google_iap_service.py\n\u2514\u2500\u2500 jobs/                     # For subscription sync\n</code></pre></p>"},{"location":"MODULAR-GUIDE/#removal-instructions","title":"Removal Instructions","text":""},{"location":"MODULAR-GUIDE/#remove-ai-gateway","title":"Remove AI Gateway","text":"<pre><code># Remove files\nrm -rf app/services/ai\nrm app/api/v1/app/ai.py\nrm app/schemas/ai.py\n\n# Update router.py - remove these lines:\n# from app.api.v1.app import ai\n# app_router.include_router(ai.router, prefix=\"/ai\")\n\n# Update pyproject.toml - remove ai optional deps or don't install them:\n# pip install -e \".\"  # Instead of pip install -e \".[ai]\"\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-email-service","title":"Remove Email Service","text":"<pre><code># Remove files\nrm -rf app/services/email\nrm app/jobs/email_jobs.py  # If exists\n\n# Update jobs/__init__.py if needed\n# Update pyproject.toml - remove email deps\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-storage-service","title":"Remove Storage Service","text":"<pre><code># Remove files\nrm -rf app/services/storage\nrm app/api/v1/app/files.py\nrm app/models/file.py\nrm app/schemas/file.py\n\n# Remove migration for file table (if already run, create a new migration to drop it)\n\n# Update router.py - remove:\n# from app.api.v1.app import files\n# app_router.include_router(files.router, prefix=\"/files\")\n\n# Update User model - remove relationship:\n# files: list[\"File\"] = Relationship(back_populates=\"owner\")\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-stripe-payments","title":"Remove Stripe Payments","text":"<pre><code># Remove files\nrm app/services/payments/stripe_service.py\nrm app/business/billing_service.py\nrm app/api/v1/app/billing.py\n\n# Update webhooks.py - remove Stripe webhook handler\n# Update router.py - remove billing router\n# Update User model - remove stripe fields (create migration)\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-applegoogle-iap","title":"Remove Apple/Google IAP","text":"<pre><code># Remove files\nrm app/services/payments/apple_iap_service.py\nrm app/services/payments/google_iap_service.py\nrm app/business/iap_service.py\n\n# Update webhooks.py - remove Apple/Google handlers\n# Update User model - remove IAP fields (create migration)\n# Update tests - remove IAP tests\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-background-jobs","title":"Remove Background Jobs","text":"<pre><code># Remove directory\nrm -rf app/jobs\n\n# Remove worker commands from Makefile\n# Remove worker service from docker-compose.yml\n# Remove arq from dependencies\n</code></pre>"},{"location":"MODULAR-GUIDE/#remove-observability","title":"Remove Observability","text":"<pre><code># Remove Sentry\nrm app/core/sentry.py\n# Update main.py - remove sentry init\n\n# Remove Metrics\nrm app/core/metrics.py\nrm app/api/v1/public/metrics.py\n# Update router.py - remove metrics router\n</code></pre>"},{"location":"MODULAR-GUIDE/#minimal-setups","title":"Minimal Setups","text":""},{"location":"MODULAR-GUIDE/#absolute-minimum-api-skeleton","title":"Absolute Minimum (API Skeleton)","text":"<p>Files to keep:</p> <pre><code>app/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 main.py                   # Simplified version\n\u251c\u2500\u2500 api/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 deps.py\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 router.py\n\u2502       \u2514\u2500\u2500 public/\n\u2502           \u251c\u2500\u2500 __init__.py\n\u2502           \u2514\u2500\u2500 health.py\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 config.py             # Minimal config\n\u2502   \u251c\u2500\u2500 db.py\n\u2502   \u2514\u2500\u2500 exceptions.py\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2514\u2500\u2500 base.py\n\u2514\u2500\u2500 schemas/\n    \u251c\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 common.py\n</code></pre> <p>Minimal <code>.env</code>: <pre><code>SECRET_KEY=\"your-secret-key-at-least-32-characters\"\nDATABASE_URL=\"postgresql+asyncpg://postgres:postgres@localhost:5432/myapp\"\n</code></pre></p> <p>Minimal <code>pyproject.toml</code> dependencies: <pre><code>dependencies = [\n    \"fastapi&gt;=0.115.0\",\n    \"uvicorn[standard]&gt;=0.32.0\",\n    \"sqlmodel&gt;=0.0.22\",\n    \"asyncpg&gt;=0.30.0\",\n    \"pydantic&gt;=2.9.0\",\n    \"pydantic-settings&gt;=2.6.0\",\n]\n</code></pre></p>"},{"location":"MODULAR-GUIDE/#your-stack-postgres-stripe-supabase","title":"Your Stack: Postgres + Stripe + Supabase","text":"<p>Here's exactly what to keep and remove:</p> <p>Keep these directories/files:</p> <pre><code>app/\n\u251c\u2500\u2500 api/\n\u2502   \u251c\u2500\u2500 deps.py\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 router.py\n\u2502       \u251c\u2500\u2500 public/\n\u2502       \u2502   \u251c\u2500\u2500 health.py\n\u2502       \u2502   \u2514\u2500\u2500 webhooks.py    # Keep Stripe + Supabase handlers only\n\u2502       \u251c\u2500\u2500 app/\n\u2502       \u2502   \u251c\u2500\u2500 users.py\n\u2502       \u2502   \u251c\u2500\u2500 projects.py    # Your resources\n\u2502       \u2502   \u2514\u2500\u2500 billing.py\n\u2502       \u2514\u2500\u2500 admin/\n\u2502           \u2514\u2500\u2500 users.py\n\u251c\u2500\u2500 core/                       # Keep ALL\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 base.py\n\u2502   \u251c\u2500\u2500 user.py\n\u2502   \u251c\u2500\u2500 project.py\n\u2502   \u2514\u2500\u2500 webhook_event.py\n\u251c\u2500\u2500 schemas/\n\u2502   \u251c\u2500\u2500 common.py\n\u2502   \u251c\u2500\u2500 user.py\n\u2502   \u2514\u2500\u2500 project.py\n\u251c\u2500\u2500 business/\n\u2502   \u251c\u2500\u2500 crud_base.py\n\u2502   \u251c\u2500\u2500 user_service.py\n\u2502   \u251c\u2500\u2500 project_service.py\n\u2502   \u2514\u2500\u2500 billing_service.py\n\u2514\u2500\u2500 services/\n    \u2514\u2500\u2500 payments/\n        \u2514\u2500\u2500 stripe_service.py\n</code></pre> <p>Remove these:</p> <pre><code># AI (not needed)\nrm -rf app/services/ai\nrm -f app/api/v1/app/ai.py\nrm -f app/schemas/ai.py\n\n# Storage (using Supabase Storage instead)\nrm -rf app/services/storage\nrm -f app/api/v1/app/files.py\nrm -f app/models/file.py\nrm -f app/schemas/file.py\n\n# Email (optional - using Supabase email)\nrm -rf app/services/email\n\n# Mobile IAP (web only)\nrm -f app/services/payments/apple_iap_service.py\nrm -f app/services/payments/google_iap_service.py\nrm -f app/business/iap_service.py\n\n# Background jobs (optional)\nrm -rf app/jobs\n\n# Load tests (optional)\nrm -rf tests/load\n</code></pre> <p>Update webhooks.py:</p> <p>Keep only: - <code>@router.post(\"/stripe\")</code> - Stripe webhooks - <code>@router.post(\"/supabase\")</code> - Supabase auth webhooks</p> <p>Remove: - <code>@router.post(\"/clerk\")</code> - Not using Clerk - <code>@router.post(\"/apple\")</code> - Not using iOS - <code>@router.post(\"/google\")</code> - Not using Android</p> <p>Update User model:</p> <p>Remove IAP fields if not needed: <pre><code># Remove these lines from app/models/user.py:\n# apple_original_transaction_id: str | None = ...\n# google_purchase_token: str | None = ...\n</code></pre></p> <p>Update router.py:</p> <pre><code># app/api/v1/router.py\nfrom fastapi import APIRouter\n\nfrom app.api.v1.admin import users as admin_users\nfrom app.api.v1.app import billing, projects, users\nfrom app.api.v1.public import health, webhooks\n\n# Public routes (no auth required)\npublic_router = APIRouter(prefix=\"/public\", tags=[\"Public\"])\npublic_router.include_router(health.router)\npublic_router.include_router(webhooks.router, prefix=\"/webhooks\")\n\n# App routes (auth required)\napp_router = APIRouter(prefix=\"/app\", tags=[\"App\"])\napp_router.include_router(users.router, prefix=\"/users\")\napp_router.include_router(projects.router, prefix=\"/projects\")\napp_router.include_router(billing.router, prefix=\"/billing\")\n\n# Admin routes (auth + admin role required)\nadmin_router = APIRouter(prefix=\"/admin\", tags=[\"Admin\"])\nadmin_router.include_router(admin_users.router, prefix=\"/users\")\n\n# Aggregate all v1 routes\napi_router = APIRouter(prefix=\"/api/v1\")\napi_router.include_router(public_router)\napi_router.include_router(app_router)\napi_router.include_router(admin_router)\n</code></pre> <p>Install only needed dependencies:</p> <pre><code>pip install -e \".[payments]\"  # Just Stripe\n# Or manually:\npip install stripe\n</code></pre>"},{"location":"MODULAR-GUIDE/#adding-components-back","title":"Adding Components Back","text":""},{"location":"MODULAR-GUIDE/#re-add-ai-gateway","title":"Re-add AI Gateway","text":"<ol> <li>Copy from original boilerplate:</li> <li><code>app/services/ai/</code></li> <li><code>app/api/v1/app/ai.py</code></li> <li> <p><code>app/schemas/ai.py</code></p> </li> <li> <p>Update <code>router.py</code>:    <pre><code>from app.api.v1.app import ai\napp_router.include_router(ai.router, prefix=\"/ai\")\n</code></pre></p> </li> <li> <p>Install dependencies:    <pre><code>pip install openai anthropic\n</code></pre></p> </li> <li> <p>Add config:    <pre><code>OPENAI_API_KEY=\"sk-...\"\nAI_DEFAULT_PROVIDER=\"openai\"\n</code></pre></p> </li> </ol>"},{"location":"MODULAR-GUIDE/#re-add-storage-service","title":"Re-add Storage Service","text":"<ol> <li>Copy from original:</li> <li><code>app/services/storage/</code></li> <li><code>app/api/v1/app/files.py</code></li> <li><code>app/models/file.py</code></li> <li> <p><code>app/schemas/file.py</code></p> </li> <li> <p>Update <code>router.py</code></p> </li> <li> <p>Run migration:    <pre><code>make migrate msg=\"add file model\"\n</code></pre></p> </li> <li> <p>Install dependencies:    <pre><code>pip install aioboto3  # For S3/R2\n# or\npip install cloudinary\n</code></pre></p> </li> </ol>"},{"location":"MODULAR-GUIDE/#re-add-background-jobs","title":"Re-add Background Jobs","text":"<ol> <li>Copy from original:</li> <li> <p><code>app/jobs/</code></p> </li> <li> <p>Install ARQ:    <pre><code>pip install arq\n</code></pre></p> </li> <li> <p>Add Redis URL to config</p> </li> <li> <p>Add to Makefile:    <pre><code>worker:\n    arq app.jobs.worker.WorkerSettings\n</code></pre></p> </li> </ol>"},{"location":"MODULAR-GUIDE/#dependency-groups","title":"Dependency Groups","text":"<p>The <code>pyproject.toml</code> has optional dependency groups:</p> <pre><code>[project.optional-dependencies]\ndev = [\"pytest\", \"ruff\", \"mypy\", ...]\nai = [\"openai\", \"anthropic\"]\nemail = [\"resend\", \"sendgrid\", \"jinja2\"]\nstorage = [\"aioboto3\", \"cloudinary\"]\npayments = [\"stripe\"]\nobservability = [\"sentry-sdk[fastapi]\", \"prometheus-client\"]\nloadtest = [\"locust\"]\nall = [\"omnistack-backend[dev,ai,email,storage,payments,observability]\"]\n</code></pre> <p>Install what you need:</p> <pre><code># Development only\npip install -e \".[dev]\"\n\n# Production with Stripe only\npip install -e \".[payments]\"\n\n# Full stack\npip install -e \".[all]\"\n\n# Custom combination\npip install -e \".[dev,payments,observability]\"\n</code></pre>"}]}